!function(e,t){t["true"]=e,window.rangy=function(){function e(e,t){var n=typeof e[t];return n==u||!(n!=c||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=c||!e[t])}function n(e,t){return typeof e[t]!=f}function a(e){return function(t,n){for(var a=n.length;a--;)if(!e(t,n[a]))return!1;return!0}}function r(e){return e&&v(e,m)&&b(e,g)}function o(e){window.alert("Rangy not supported in your browser. Reason: "+e),x.initialized=!0,x.supported=!1}function i(e){var t="Rangy warning: "+e;x.config.alertOnWarn?window.alert(t):typeof window.console!=f&&typeof window.console.log!=f&&window.console.log(t)}function l(){if(!x.initialized){var n,a=!1,i=!1;e(document,"createRange")&&(n=document.createRange(),v(n,h)&&b(n,p)&&(a=!0),n.detach());var l=t(document,"body")?document.body:document.getElementsByTagName("body")[0];l&&e(l,"createTextRange")&&(n=l.createTextRange(),r(n)&&(i=!0)),a||i||o("Neither Range nor TextRange are implemented"),x.initialized=!0,x.features={implementsDomRange:a,implementsTextRange:i};for(var s=E.concat(w),d=0,c=s.length;c>d;++d)try{s[d](x)}catch(u){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",u)}}}function s(e){e=e||window,l();for(var t=0,n=C.length;n>t;++t)C[t](e)}function d(e){this.name=e,this.initialized=!1,this.supported=!1}var c="object",u="function",f="undefined",p=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],h=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],g=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],m=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=a(e),y=a(t),b=a(n),x={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:v,areHostObjects:y,areHostProperties:b,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};x.fail=o,x.warn=i,{}.hasOwnProperty?x.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:o("hasOwnProperty not supported");var w=[],E=[];x.init=l,x.addInitListener=function(e){x.initialized?e(x):w.push(e)};var C=[];x.addCreateMissingNativeApiListener=function(e){C.push(e)},x.createMissingNativeApi=s,d.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},d.prototype.warn=function(e){x.warn("Module "+this.name+": "+e)},d.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},x.createModule=function(e,t){var n=new d(e);x.modules[e]=n,E.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},x.requireModules=function(e){for(var t,n,a=0,r=e.length;r>a;++a){if(n=e[a],t=x.modules[n],!(t&&t instanceof d))throw new Error("Module '"+n+"' not found");if(!t.supported)throw new Error("Module '"+n+"' not supported")}};var S=!1,T=function(){S||(S=!0,x.initialized||l())};return typeof window==f?void o("No window found"):typeof document==f?void o("No document found"):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",T,!1),e(window,"addEventListener")?window.addEventListener("load",T,!1):e(window,"attachEvent")?window.attachEvent("onload",T):o("Window does not have required addEventListener or attachEvent method"),x)}(),rangy.createModule("DomUtil",function(e,t){function n(e){var t;return typeof e.namespaceURI==T||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function a(e){var t=e.parentNode;return 1==t.nodeType?t:null}function r(e){for(var t=0;e=e.previousSibling;)t++;return t}function o(e){var t;return d(e)?e.length:(t=e.childNodes)?t.length:0}function i(e,t){var n,a=[];for(n=e;n;n=n.parentNode)a.push(n);for(n=t;n;n=n.parentNode)if(k(a,n))return n;return null}function l(e,t,n){for(var a=n?t:t.parentNode;a;){if(a===e)return!0;a=a.parentNode}return!1}function s(e,t,n){for(var a,r=n?e:e.parentNode;r;){if(a=r.parentNode,a===t)return r;r=a}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function c(e,t){var n=t.nextSibling,a=t.parentNode;return n?a.insertBefore(e,n):a.appendChild(e),e}function u(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),c(n,e),n}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=T)return e.ownerDocument;if(typeof e.document!=T)return e.document;if(e.parentNode)return f(e.parentNode);throw new Error("getDocument: no document found for node")}function p(e){var t=f(e);if(typeof t.defaultView!=T)return t.defaultView;if(typeof t.parentWindow!=T)return t.parentWindow;throw new Error("Cannot get a window object for node")}function h(e){if(typeof e.contentDocument!=T)return e.contentDocument;if(typeof e.contentWindow!=T)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function g(e){if(typeof e.contentWindow!=T)return e.contentWindow;if(typeof e.contentDocument!=T)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function m(e){return N.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function v(e){for(var t;t=e.parentNode;)e=t;return e}function y(e,t,n,a){var o,l,d,c,u;if(e==n)return t===a?0:a>t?-1:1;if(o=s(n,e,!0))return t<=r(o)?-1:1;if(o=s(e,n,!0))return r(o)<a?-1:1;if(l=i(e,n),d=e===l?l:s(e,l,!0),c=n===l?l:s(n,l,!0),d===c)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(u=l.firstChild;u;){if(u===d)return-1;if(u===c)return 1;u=u.nextSibling}throw new Error("Should not be here!")}function b(e){for(var t,n=f(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function x(e){if(!e)return"[No node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function w(e){this.root=e,this._next=e}function E(e){return new w(e)}function C(e,t){this.node=e,this.offset=t}function S(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var T="undefined",N=e.util;N.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),N.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var $=document.createElement("div");N.areHostMethods($,["insertBefore","appendChild","cloneNode"]||!N.areHostObjects($,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),N.isHostProperty($,"innerHTML")||t.fail("Element is missing innerHTML property");var R=document.createTextNode("test");N.areHostMethods(R,["splitText","deleteData","insertData","appendData","cloneNode"]||!N.areHostObjects($,["previousSibling","nextSibling","childNodes","parentNode"])||!N.areHostProperties(R,["data"]))||t.fail("Incomplete Text Node implementation");var k=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};w.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},C.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+x(this.node)+":"+this.offset+")]"}},S.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},S.prototype.toString=function(){return this.message},e.dom={arrayContains:k,isHtmlNamespace:n,parentElement:a,getNodeIndex:r,getNodeLength:o,getCommonAncestor:i,isAncestorOf:l,getClosestAncestorIn:s,isCharacterDataNode:d,insertAfter:c,splitDataNode:u,getDocument:f,getWindow:p,getIframeWindow:g,getIframeDocument:h,getBody:m,getRootContainer:v,comparePoints:y,inspectNode:x,fragmentFromNodeChildren:b,createIterator:E,DomPosition:C},e.DOMException=S}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(B.isAncestorOf(e,t.startContainer,!0)||B.isAncestorOf(e,t.endContainer,!0))}function n(e){return B.getDocument(e.startContainer)}function a(e,t,n){var a=e._listeners[t];if(a)for(var r=0,o=a.length;o>r;++r)a[r].call(e,{target:e,args:n})}function r(e){return new I(e.parentNode,B.getNodeIndex(e))}function o(e){return new I(e.parentNode,B.getNodeIndex(e)+1)}function i(e,t,n){var a=11==e.nodeType?e.firstChild:e;return B.isCharacterDataNode(t)?n==t.length?B.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:B.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),a}function l(e){for(var t,a,r,o=n(e.range).createDocumentFragment();a=e.next();){if(t=e.isPartiallySelectedSubtree(),a=a.cloneNode(!t),t&&(r=e.getSubtreeIterator(),a.appendChild(l(r)),r.detach(!0)),10==a.nodeType)throw new P("HIERARCHY_REQUEST_ERR");o.appendChild(a)}return o}function s(e,t,n){var a,r;n=n||{stop:!1};for(var o,i;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1)return void(n.stop=!0);if(i=e.getSubtreeIterator(),s(i,t,n),i.detach(!0),n.stop)return}else for(a=B.createIterator(o);r=a.next();)if(t(r)===!1)return void(n.stop=!0)}function d(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach(!0)):e.remove()}function c(e){for(var t,a,r=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),a=e.getSubtreeIterator(),t.appendChild(c(a)),a.detach(!0)):e.remove(),10==t.nodeType)throw new P("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function u(e,t,n){var a,r=!(!t||!t.length),o=!!n;r&&(a=new RegExp("^("+t.join("|")+")$"));var i=[];return s(new p(e,!1),function(e){r&&!a.test(e.nodeType)||o&&!n(e)||i.push(e)}),i}function f(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+B.inspectNode(e.startContainer)+":"+e.startOffset+", "+B.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&B.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||B.isCharacterDataNode(this.sc)?B.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||B.isCharacterDataNode(this.ec)?B.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function h(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function g(e,t,n){this.nodes=u(e,t,n),this._next=this.nodes[0],this._position=0}function m(e){return function(t,n){for(var a,r=n?t:t.parentNode;r;){if(a=r.nodeType,B.arrayContains(e,a))return r;r=r.parentNode}return null}}function v(e,t){if(G(e,t))throw new h("INVALID_NODE_TYPE_ERR")}function y(e){if(!e.startContainer)throw new P("INVALID_STATE_ERR")}function b(e,t){if(!B.arrayContains(t,e.nodeType))throw new h("INVALID_NODE_TYPE_ERR")}function x(e,t){if(0>t||t>(B.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new P("INDEX_SIZE_ERR")}function w(e,t){if(j(e,!0)!==j(t,!0))throw new P("WRONG_DOCUMENT_ERR")}function E(e){if(K(e,!0))throw new P("NO_MODIFICATION_ALLOWED_ERR")}function C(e,t){if(!e)throw new P(t)}function S(e){return!B.arrayContains(W,e.nodeType)&&!j(e,!0)}function T(e,t){return t<=(B.isCharacterDataNode(e)?e.length:e.childNodes.length)}function N(e){return!!e.startContainer&&!!e.endContainer&&!S(e.startContainer)&&!S(e.endContainer)&&T(e.startContainer,e.startOffset)&&T(e.endContainer,e.endOffset)}function $(e){if(y(e),!N(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function R(){}function k(e){e.START_TO_START=et,e.START_TO_END=tt,e.END_TO_END=nt,e.END_TO_START=at,e.NODE_BEFORE=rt,e.NODE_AFTER=ot,e.NODE_BEFORE_AND_AFTER=it,e.NODE_INSIDE=lt}function D(e){k(e),k(e.prototype)}function A(e,t){return function(){$(this);var n,a,r=this.startContainer,i=this.startOffset,l=this.commonAncestorContainer,d=new p(this,!0);r!==l&&(n=B.getClosestAncestorIn(r,l,!0),a=o(n),r=a.node,i=a.offset),s(d,E),d.reset();var c=e(d);return d.detach(),t(this,r,i,r,i),c}}function L(n,a,i){function l(e,t){return function(n){y(this),b(n,q),b(U(n),W);var a=(e?r:o)(n);(t?s:u)(this,a.node,a.offset)}}function s(e,t,n){var r=e.endContainer,o=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((U(t)!=U(r)||1==B.comparePoints(t,n,r,o))&&(r=t,o=n),a(e,t,n,r,o))}function u(e,t,n){var r=e.startContainer,o=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((U(t)!=U(r)||-1==B.comparePoints(t,n,r,o))&&(r=t,o=n),a(e,r,o,t,n))}function f(e,t,n){(t!==e.startContainer||n!==e.startOffset||t!==e.endContainer||n!==e.endOffset)&&a(e,t,n,t,n)}n.prototype=new R,e.util.extend(n.prototype,{setStart:function(e,t){y(this),v(e,!0),x(e,t),s(this,e,t)},setEnd:function(e,t){y(this),v(e,!0),x(e,t),u(this,e,t)},setStartBefore:l(!0,!0),setStartAfter:l(!1,!0),setEndBefore:l(!0,!1),setEndAfter:l(!1,!1),collapse:function(e){$(this),e?a(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):a(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){y(this),v(e,!0),a(this,e,0,e,B.getNodeLength(e))},selectNode:function(e){y(this),v(e,!1),b(e,q);var t=r(e),n=o(e);a(this,t.node,t.offset,n.node,n.offset)},extractContents:A(c,a),deleteContents:A(d,a),canSurroundContents:function(){$(this),E(this.startContainer),E(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){i(this)},splitBoundaries:function(){$(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,o=e===n;B.isCharacterDataNode(n)&&r>0&&r<n.length&&B.splitDataNode(n,r),B.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=B.splitDataNode(e,t),o?(r-=t,n=e):n==e.parentNode&&r>=B.getNodeIndex(e)&&r++,t=0),a(this,e,t,n,r)},normalizeBoundaries:function(){$(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},i=function(a){var o=a.previousSibling;if(o&&o.nodeType==a.nodeType){e=a;var i=a.length;if(t=o.length,a.insertData(0,o.data),o.parentNode.removeChild(o),e==n)r+=t,n=e;else if(n==a.parentNode){var l=B.getNodeIndex(a);r==l?(n=a,r=i):r>l&&r--}}},l=!0;if(B.isCharacterDataNode(n))n.length==r&&o(n);else{if(r>0){var s=n.childNodes[r-1];s&&B.isCharacterDataNode(s)&&o(s)}l=!this.collapsed}if(l){if(B.isCharacterDataNode(e))0==t&&i(e);else if(t<e.childNodes.length){var d=e.childNodes[t];d&&B.isCharacterDataNode(d)&&i(d)}}else e=n,t=r;a(this,e,t,n,r)},collapseToPoint:function(e,t){y(this),v(e,!0),x(e,t),f(this,e,t)}}),D(n)}function M(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:B.getCommonAncestor(e.startContainer,e.endContainer)}function _(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!==n,l=e.endContainer!==r||e.endOffset!==o;e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,M(e),a(e,"boundarychange",{startMoved:i,endMoved:l})}function O(e){y(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,a(e,"detach",null),e._listeners=null}function H(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},M(this)}e.requireModules(["DomUtil"]);var B=e.dom,I=B.DomPosition,P=e.DOMException;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,B.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!B.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new H(n(this.range));var t=this._current,a=t,r=0,o=t,i=B.getNodeLength(t);B.isAncestorOf(t,this.sc,!0)&&(a=this.sc,r=this.so),B.isAncestorOf(t,this.ec,!0)&&(o=this.ec,i=this.eo),_(e,a,r,o,i)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},h.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},h.prototype.toString=function(){return this.message},g.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var q=[1,3,4,5,7,8,10],W=[2,9,11],z=[5,6,10,12],F=[1,3,4,5,7,8,10,11],V=[1,3,4,5,7,8],U=B.getRootContainer,j=m([9,11]),K=m(z),G=m([6,10,12]),Y=document.createElement("style"),Q=!1;try{Y.innerHTML="<b>x</b>",Q=3==Y.firstChild.nodeType}catch(X){}e.features.htmlParsingConforms=Q;var Z=Q?function(e){var t=this.startContainer,n=B.getDocument(t);if(!t)throw new P("INVALID_STATE_ERR");var a=null;return 1==t.nodeType?a=t:B.isCharacterDataNode(t)&&(a=B.parentElement(t)),a=null===a||"HTML"==a.nodeName&&B.isHtmlNamespace(B.getDocument(a).documentElement)&&B.isHtmlNamespace(a)?n.createElement("body"):a.cloneNode(!1),a.innerHTML=e,B.fragmentFromNodeChildren(a)}:function(e){y(this);var t=n(this),a=t.createElement("body");return a.innerHTML=e,B.fragmentFromNodeChildren(a)},J=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],et=0,tt=1,nt=2,at=3,rt=0,ot=1,it=2,lt=3;R.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){$(this),w(this.startContainer,t.startContainer);var n,a,r,o,i=e==at||e==et?"start":"end",l=e==tt||e==et?"start":"end";return n=this[i+"Container"],a=this[i+"Offset"],r=t[l+"Container"],o=t[l+"Offset"],B.comparePoints(n,a,r,o)},insertNode:function(e){if($(this),b(e,F),E(this.startContainer),B.isAncestorOf(e,this.startContainer,!0))throw new P("HIERARCHY_REQUEST_ERR");var t=i(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){$(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&B.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var a=new p(this,!0);return e=l(a),a.detach(),e},canSurroundContents:function(){$(this),E(this.startContainer),E(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(b(e,V),!this.canSurroundContents())throw new h("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);i(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){$(this);for(var e,t=new H(n(this)),a=J.length;a--;)e=J[a],t[e]=this[e];return t},toString:function(){$(this);var e=this.startContainer;if(e===this.endContainer&&B.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new p(this,!0);return s(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){$(this);var t=e.parentNode,n=B.getNodeIndex(e);if(!t)throw new P("NOT_FOUND_ERR");var a=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return 0>a?r>0?it:rt:r>0?ot:lt},comparePoint:function(e,t){return $(this),C(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),B.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:B.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){$(this);var e=n(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if($(this),C(e,"NOT_FOUND_ERR"),B.getDocument(e)!==n(this))return!1;var a=e.parentNode,r=B.getNodeIndex(e);C(a,"NOT_FOUND_ERR");var o=B.comparePoints(a,r,this.endContainer,this.endOffset),i=B.comparePoints(a,r+1,this.startContainer,this.startOffset);return t?0>=o&&i>=0:0>o&&i>0},isPointInRange:function(e,t){return $(this),C(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),B.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&B.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if($(this),n(e)!=n(this))throw new P("WRONG_DOCUMENT_ERR");var a=B.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),r=B.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=a&&r>=0:0>a&&r>0},intersection:function(e){if(this.intersectsRange(e)){var t=B.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=B.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),a=this.cloneRange();return-1==t&&a.setStart(e.startContainer,e.startOffset),1==n&&a.setEnd(e.endContainer,e.endOffset),a}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==B.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==B.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new h("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==lt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,B.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var a=n.pop();t.setEnd(a,a.length);var r=this.containsRange(t);return t.detach(),r}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return $(this),new g(this,e,t)},getNodes:function(e,t){return $(this),u(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){y(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){y(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return H.rangesEqual(this,e)},isValid:function(){return N(this)},inspect:function(){return f(this)}},L(H,_,O),e.rangePrototype=R.prototype,H.rangeProperties=J,H.RangeIterator=p,H.copyComparisonConstants=D,H.createPrototypeRange=L,H.inspect=f,H.getRangeDocument=n,H.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=H,e.RangeException=h}),rangy.createModule("WrappedRange",function(e){function t(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var a=n.parentElement();n=e.duplicate(),n.collapse(!1);var r=n.parentElement(),o=a==r?a:i.getCommonAncestor(a,r);return o==t?o:i.getCommonAncestor(t,o)}function n(e){return 0==e.compareEndPoints("StartToEnd",e)}function a(e,t,n,a){var r=e.duplicate();r.collapse(n);var o=r.parentElement();if(i.isAncestorOf(t,o,!0)||(o=t),!o.canHaveHTML)return new l(o.parentNode,i.getNodeIndex(o));var s,d,c,u,f,p=i.getDocument(o).createElement("span"),h=n?"StartToStart":"StartToEnd";do o.insertBefore(p,p.previousSibling),r.moveToElementText(p);while((s=r.compareEndPoints(h,e))>0&&p.previousSibling);if(f=p.nextSibling,-1==s&&f&&i.isCharacterDataNode(f)){r.setEndPoint(n?"EndToStart":"EndToEnd",e);var g;if(/[\r\n]/.test(f.data)){var m=r.duplicate(),v=m.text.replace(/\r\n/g,"\r").length;for(g=m.moveStart("character",v);-1==(s=m.compareEndPoints("StartToEnd",m));)g++,m.moveStart("character",1)}else g=r.text.length;u=new l(f,g)}else d=(a||!n)&&p.previousSibling,c=(a||n)&&p.nextSibling,u=c&&i.isCharacterDataNode(c)?new l(c,0):d&&i.isCharacterDataNode(d)?new l(d,d.length):new l(o,i.getNodeIndex(p));return p.parentNode.removeChild(p),u}function r(e,t){var n,a,r,o,l=e.offset,s=i.getDocument(e.node),d=s.body.createTextRange(),c=i.isCharacterDataNode(e.node);return c?(n=e.node,a=n.parentNode):(o=e.node.childNodes,n=l<o.length?o[l]:null,a=e.node),r=s.createElement("span"),r.innerHTML="&#feff;",n?a.insertBefore(r,n):a.appendChild(r),d.moveToElementText(r),d.collapse(!t),a.removeChild(r),c&&d[t?"moveStart":"moveEnd"]("character",l),d}e.requireModules(["DomUtil","DomRange"]);var o,i=e.dom,l=i.DomPosition,s=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){o=function(e){this.textRange=e,this.refresh()},o.prototype=new s(document),o.prototype.refresh=function(){var e,r,o=t(this.textRange);n(this.textRange)?r=e=a(this.textRange,o,!0,!0):(e=a(this.textRange,o,!0,!1),r=a(this.textRange,o,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(r.node,r.offset)},s.copyComparisonConstants(o);var d=function(){return this}();"undefined"==typeof d.Range&&(d.Range=o),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else!function(){function t(e){for(var t,n=c.length;n--;)t=c[n],e[t]=e.nativeRange[t]}function n(e,t,n,a,r){var o=e.startContainer!==t||e.startOffset!=n,i=e.endContainer!==a||e.endOffset!=r;(o||i)&&(e.setEnd(a,r),e.setStart(t,n))}function a(e){e.nativeRange.detach(),e.detached=!0;for(var t,n=c.length;n--;)t=c[n],e[t]=null}var r,l,d,c=s.rangeProperties;o=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,t(this)},s.createPrototypeRange(o,n,a),r=o.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},r.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},r.collapse=function(e){this.nativeRange.collapse(e),t(this)},r.cloneRange=function(){return new o(this.nativeRange.cloneRange())},r.refresh=function(){t(this)},r.toString=function(){return this.nativeRange.toString()};var u=document.createTextNode("test");i.getBody(document).appendChild(u);var f=document.createRange();f.setStart(u,0),f.setEnd(u,0);try{f.setStart(u,1),l=!0,r.setStart=function(e,n){this.nativeRange.setStart(e,n),t(this)},r.setEnd=function(e,n){this.nativeRange.setEnd(e,n),t(this)},d=function(e){return function(n){this.nativeRange[e](n),t(this)}}}catch(p){l=!1,r.setStart=function(e,n){try{this.nativeRange.setStart(e,n)}catch(a){this.nativeRange.setEnd(e,n),this.nativeRange.setStart(e,n)}t(this)},r.setEnd=function(e,n){try{this.nativeRange.setEnd(e,n)}catch(a){this.nativeRange.setStart(e,n),this.nativeRange.setEnd(e,n)}t(this)},d=function(e,n){return function(a){try{this.nativeRange[e](a)}catch(r){this.nativeRange[n](a),this.nativeRange[e](a)}t(this)}}}r.setStartBefore=d("setStartBefore","setEndBefore"),r.setStartAfter=d("setStartAfter","setEndAfter"),r.setEndBefore=d("setEndBefore","setStartBefore"),r.setEndAfter=d("setEndAfter","setStartAfter"),f.selectNodeContents(u),r.selectNodeContents=f.startContainer==u&&f.endContainer==u&&0==f.startOffset&&f.endOffset==u.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,s.getEndOffset(e))},f.selectNodeContents(u),f.setEnd(u,3);var h=document.createRange();h.selectNodeContents(u),h.setEnd(u,4),h.setStart(u,2),r.compareBoundaryPoints=-1==f.compareBoundaryPoints(f.START_TO_END,h)&1==f.compareBoundaryPoints(f.END_TO_START,h)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(f,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),i.getBody(document).removeChild(u),f.detach(),h.detach()}(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(o.rangeToTextRange=function(e){if(e.collapsed){var t=r(new l(e.startContainer,e.startOffset),!0);return t}var n=r(new l(e.startContainer,e.startOffset),!0),a=r(new l(e.endContainer,e.endOffset),!1),o=i.getDocument(e.startContainer).body.createTextRange();return o.setEndPoint("StartToStart",n),o.setEndPoint("EndToEnd",a),o}),o.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=o,e.createRange=function(t){return t=t||document,new o(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new s(e)},e.createIframeRange=function(t){return e.createRange(i.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(i.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function a(e){return(e||window).document.selection}function r(e,t,n){var a=n?"end":"start",r=n?"start":"end";e.anchorNode=t[a+"Container"],e.anchorOffset=t[a+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function o(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function i(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function l(t){var n;return t instanceof S?(n=t._selectionNativeRange,n||(n=e.createNativeRange(E.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof T?n=t.nativeRange:e.features.implementsDomRange&&t instanceof E.getWindow(t.startContainer).Range&&(n=t),n}function s(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!E.isAncestorOf(e[0],e[t]))return!1;return!0}function d(e){var t=e.getNodes();if(!s(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function c(e){return!!e&&"undefined"!=typeof e.text}function u(e,t){var n=new T(t);e._ranges=[n],r(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function f(t){if(t._ranges.length=0,"None"==t.docSelection.type)i(t);else{var n=t.docSelection.createRange();if(c(n))u(t,n);else{t.rangeCount=n.length;for(var a,o=E.getDocument(n.item(0)),l=0;l<t.rangeCount;++l)a=e.createRange(o),a.selectNode(n.item(l)),t._ranges.push(a);
t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,r(t,t._ranges[t.rangeCount-1],!1)}}}function p(e,t){for(var n=e.docSelection.createRange(),a=d(t),r=E.getDocument(n.item(0)),o=E.getBody(r).createControlRange(),i=0,l=n.length;l>i;++i)o.add(n.item(i));try{o.add(a)}catch(s){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),f(e)}function h(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function g(e,t){for(var n,a=E.getDocument(t[0].startContainer),r=E.getBody(a).createControlRange(),o=0;rangeCount>o;++o){n=d(t[o]);try{r.add(n)}catch(i){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),f(e)}function m(e,t){if(e.anchorNode&&E.getDocument(e.anchorNode)!==E.getDocument(t))throw new N("WRONG_DOCUMENT_ERR")}function v(e){var t=[],n=new $(e.anchorNode,e.anchorOffset),a=new $(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var o=0,i=e.rangeCount;i>o;++o)t[o]=S.inspect(e.getRangeAt(o));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+a.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var y,b,x="boolean",w="_rangySelection",E=e.dom,C=e.util,S=e.DomRange,T=e.WrappedRange,N=e.DOMException,$=E.DomPosition,R="Control",k=e.util.isHostMethod(window,"getSelection"),D=e.util.isHostObject(document,"selection"),A=D&&(!k||e.config.preferTextRange);A?(y=a,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return"None"!=n.type||E.getDocument(n.createRange().parentElement())==t}):k?(y=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=y;var L=y(),M=e.createNativeRange(document),_=E.getBody(document),O=C.areHostObjects(L,["anchorNode","focusNode"]&&C.areHostProperties(L,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=O;var H=C.isHostMethod(L,"extend");e.features.selectionHasExtend=H;var B="number"==typeof L.rangeCount;e.features.selectionHasRangeCount=B;var I=!1,P=!0;C.areHostMethods(L,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof L.rangeCount&&e.features.implementsDomRange&&!function(){var e=document.createElement("iframe");e.frameBorder=0,e.style.position="absolute",e.style.left="-10000px",_.appendChild(e);var t=E.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=E.getIframeWindow(e).getSelection(),a=t.documentElement,r=a.lastChild,o=r.firstChild,i=t.createRange();i.setStart(o,1),i.collapse(!0),n.addRange(i),P=1==n.rangeCount,n.removeAllRanges();var l=i.cloneRange();i.setStart(o,0),l.setEnd(o,2),n.addRange(i),n.addRange(l),I=2==n.rangeCount,i.detach(),l.detach(),_.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=I,e.features.collapsedNonEditableSelectionsSupported=P;var q,W=!1;_&&C.isHostMethod(_,"createControlRange")&&(q=_.createControlRange(),C.areHostProperties(q,["item","add"])&&(W=!0)),e.features.implementsControlRange=W,b=O?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var z;C.isHostMethod(L,"getRangeAt")?z=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:O&&(z=function(t){var n=E.getDocument(t.anchorNode),a=e.createRange(n);return a.setStart(t.anchorNode,t.anchorOffset),a.setEnd(t.focusNode,t.focusOffset),a.collapsed!==this.isCollapsed&&(a.setStart(t.focusNode,t.focusOffset),a.setEnd(t.anchorNode,t.anchorOffset)),a}),e.getSelection=function(e){e=e||window;var t=e[w],n=y(e),r=D?a(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh(e)):(t=new h(n,r,e),e[w]=t),t},e.getIframeSelection=function(t){return e.getSelection(E.getIframeWindow(t))};var F=h.prototype;if(!A&&O&&C.areHostMethods(L,["removeAllRanges","addRange"])){F.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),i(this)};var V=function(t,n){var a=S.getRangeDocument(n),r=e.createRange(a);r.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(l(r)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};F.addRange=B?function(t,n){if(W&&D&&this.docSelection.type==R)p(this,t);else if(n&&H)V(this,t);else{var a;if(I?a=this.rangeCount:(this.removeAllRanges(),a=0),this.nativeSelection.addRange(l(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==a+1){if(e.config.checkSelectionRanges){var o=z(this.nativeSelection,this.rangeCount-1);o&&!S.rangesEqual(o,t)&&(t=new T(o))}this._ranges[this.rangeCount-1]=t,r(this,t,K(this.nativeSelection)),this.isCollapsed=b(this)}else this.refresh()}}:function(e,t){t&&H?V(this,e):(this.nativeSelection.addRange(l(e)),this.refresh())},F.setRanges=function(e){if(W&&e.length>1)g(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(C.isHostMethod(L,"empty")&&C.isHostMethod(M,"select")&&W&&A))return t.fail("No means of selecting a Range or TextRange was found"),!1;F.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=E.getDocument(this.anchorNode);else if(this.docSelection.type==R){var t=this.docSelection.createRange();t.length&&(e=E.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(a){}i(this)},F.addRange=function(e){this.docSelection.type==R?p(this,e):(T.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,e,!1))},F.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?g(this,e):t&&this.addRange(e[0])}}F.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new N("INDEX_SIZE_ERR");return this._ranges[e]};var U;if(A)U=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=E.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==R?f(t):c(n)?u(t,n):i(t)};else if(C.isHostMethod(L,"getRangeAt")&&"number"==typeof L.rangeCount)U=function(t){if(W&&D&&t.docSelection.type==R)f(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,a=t.rangeCount;a>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));r(t,t._ranges[t.rangeCount-1],K(t.nativeSelection)),t.isCollapsed=b(t)}else i(t)};else{if(!O||typeof L.isCollapsed!=x||typeof M.collapsed!=x||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;U=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=z(n,0),e._ranges=[t],e.rangeCount=1,o(e),e.isCollapsed=b(e)):i(e)}}F.refresh=function(e){var t=e?this._ranges.slice(0):null;if(U(this),e){var n=t.length;if(n!=this._ranges.length)return!1;for(;n--;)if(!S.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var j=function(e,t){var n=e.getAllRanges(),a=!1;e.removeAllRanges();for(var r=0,o=n.length;o>r;++r)a||t!==n[r]?e.addRange(n[r]):a=!0;e.rangeCount||i(e)};F.removeRange=W?function(e){if(this.docSelection.type==R){for(var t,n=this.docSelection.createRange(),a=d(e),r=E.getDocument(n.item(0)),o=E.getBody(r).createControlRange(),i=!1,l=0,s=n.length;s>l;++l)t=n.item(l),t!==a||i?o.add(n.item(l)):i=!0;o.select(),f(this)}else j(this,e)}:function(e){j(this,e)};var K;!A&&O&&e.features.implementsDomRange?(K=function(e){var t=!1;return e.anchorNode&&(t=1==E.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},F.isBackwards=function(){return K(this)}):K=F.isBackwards=function(){return!1},F.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},F.collapse=function(t,n){m(this,t);var a=e.createRange(E.getDocument(t));a.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(a),this.isCollapsed=!0},F.collapseToStart=function(){if(!this.rangeCount)throw new N("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},F.collapseToEnd=function(){if(!this.rangeCount)throw new N("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},F.selectAllChildren=function(t){m(this,t);var n=e.createRange(E.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},F.deleteFromDocument=function(){if(W&&D&&this.docSelection.type==R){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var a=0,r=n.length;r>a;++a)n[a].deleteContents();this.addRange(n[r-1])}},F.getAllRanges=function(){return this._ranges.slice(0)},F.setSingleRange=function(e){this.setRanges([e])},F.containsNode=function(e,t){for(var n=0,a=this._ranges.length;a>n;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},F.toHtml=function(){var e="";if(this.rangeCount){for(var t=S.getRangeDocument(this._ranges[0]).createElement("div"),n=0,a=this._ranges.length;a>n;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},F.getName=function(){return"WrappedSelection"},F.inspect=function(){return v(this)},F.detach=function(){this.win[w]=null,this.win=this.anchorNode=this.focusNode=null},h.inspect=v,e.Selection=h,e.selectionPrototype=F,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),rangy.createModule("SaveRestore",function(e,t){function n(e,t){return(t||document).getElementById(e)}function a(e,t){var n,a="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),r=c.getDocument(e.startContainer),o=e.cloneRange();return o.collapse(t),n=r.createElement("span"),n.id=a,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(r.createTextNode(u)),o.insertNode(n),o.detach(),n}function r(e,a,r,o){var i=n(r,e);i?(a[o?"setStartBefore":"setEndBefore"](i),i.parentNode.removeChild(i)):t.warn("Marker element has been removed. Cannot restore selection.")}function o(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function i(r){r=r||window;var i=r.document;if(!e.isSelectionValid(r))return void t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");var l,s,d,c=e.getSelection(r),u=c.getAllRanges(),f=[];u.sort(o);for(var p=0,h=u.length;h>p;++p)d=u[p],d.collapsed?(s=a(d,!1),f.push({markerId:s.id,collapsed:!0})):(s=a(d,!1),l=a(d,!0),f[p]={startMarkerId:l.id,endMarkerId:s.id,collapsed:!1,backwards:1==u.length&&c.isBackwards()});for(p=h-1;p>=0;--p)d=u[p],d.collapsed?d.collapseBefore(n(f[p].markerId,i)):(d.setEndBefore(n(f[p].endMarkerId,i)),d.setStartAfter(n(f[p].startMarkerId,i)));return c.setRanges(u),{win:r,doc:i,rangeInfos:f,restored:!1}}function l(a,o){if(!a.restored){for(var i,l,s=a.rangeInfos,d=e.getSelection(a.win),c=[],u=s.length,f=u-1;f>=0;--f){if(i=s[f],l=e.createRange(a.doc),i.collapsed){var p=n(i.markerId,a.doc);if(p){p.style.display="inline";var h=p.previousSibling;h&&3==h.nodeType?(p.parentNode.removeChild(p),l.collapseToPoint(h,h.length)):(l.collapseBefore(p),p.parentNode.removeChild(p))}else t.warn("Marker element has been removed. Cannot restore selection.")}else r(a.doc,l,i.startMarkerId,!0),r(a.doc,l,i.endMarkerId,!1);1==u&&l.normalizeBoundaries(),c[f]=l}1==u&&o&&e.features.selectionHasExtend&&s[0].backwards?(d.removeAllRanges(),d.addRange(c[0],!0)):d.setRanges(c),a.restored=!0}}function s(e,t){var a=n(t,e);a&&a.parentNode.removeChild(a)}function d(e){for(var t,n=e.rangeInfos,a=0,r=n.length;r>a;++a)t=n[a],t.collapsed?s(e.doc,t.markerId):(s(e.doc,t.startMarkerId),s(e.doc,t.endMarkerId))}e.requireModules(["DomUtil","DomRange","WrappedRange"]);var c=e.dom,u="";e.saveSelection=i,e.restoreSelection=l,e.removeMarkerElement=s,e.removeMarkers=d})}({},function(){return this}()),!function(e,t){t["true"]=e,function(e,t){"use strict";function n(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return o(t,c(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}function a(e){var n=[],a=c(n,t.noop);return a.chars(e),n.join("")}function r(e){var t,n={},a=e.split(",");for(t=0;t<a.length;t++)n[a[t]]=!0;return n}function o(e,n){function a(e,a,o,l){if(a=t.lowercase(a),N[a])for(;c.last()&&$[c.last()];)r("",c.last());T[a]&&c.last()==a&&r("",a),l=E[a]||!!l,l||c.push(a);var s={};o.replace(h,function(e,t,n,a,r){var o=n||a||r||"";s[t]=i(o)}),n.start&&n.start(a,s,l)}function r(e,a){var r,o=0;if(a=t.lowercase(a))for(o=c.length-1;o>=0&&c[o]!=a;o--);if(o>=0){for(r=c.length-1;r>=o;r--)n.end&&n.end(c[r]);c.length=o}}"string"!=typeof e&&(e=null===e||"undefined"==typeof e?"":""+e);var o,l,s,d,c=[],x=e;for(c.last=function(){return c[c.length-1]};e;){if(d="",l=!0,c.last()&&k[c.last()]?(e=e.replace(new RegExp("([^]*)<\\s*\\/\\s*"+c.last()+"[^>]*>","i"),function(e,t){return t=t.replace(v,"$1").replace(b,"$1"),n.chars&&n.chars(i(t)),""}),r("",c.last())):(0===e.indexOf("<!--")?(o=e.indexOf("--",4),o>=0&&e.lastIndexOf("-->",o)===o&&(n.comment&&n.comment(e.substring(4,o)),e=e.substring(o+3),l=!1)):y.test(e)?(s=e.match(y),s&&(e=e.replace(s[0],""),l=!1)):m.test(e)?(s=e.match(p),s&&(e=e.substring(s[0].length),s[0].replace(p,r),l=!1)):g.test(e)&&(s=e.match(f),s?(s[4]&&(e=e.substring(s[0].length),s[0].replace(f,a)),l=!1):(d+="<",e=e.substring(1))),l&&(o=e.indexOf("<"),d+=0>o?e:e.substring(0,o),e=0>o?"":e.substring(o),n.chars&&n.chars(i(d)))),e==x)throw u("badparse","The sanitizer was unable to parse the following block of html: {0}",e);x=e}r()}function i(e){if(!e)return"";var t=H.exec(e),n=t[1],a=t[3],r=t[2];return r&&(O.innerHTML=r.replace(/</g,"&lt;"),r="textContent"in O?O.textContent:O.innerText),n+r+a}function l(e){return e.replace(/&/g,"&amp;").replace(x,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(n-56320)+65536)+";"}).replace(w,function(e){var t=e.charCodeAt(0);return 159>=t||173==t||t>=1536&&1540>=t||1807==t||6068==t||6069==t||t>=8204&&8207>=t||t>=8232&&8239>=t||t>=8288&&8303>=t||65279==t||t>=65520&&65535>=t?"&#"+t+";":e}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(e){var n="",a=e.split(";");return t.forEach(a,function(e){var a=e.split(":");if(2==a.length){var r=B(t.lowercase(a[0])),e=B(t.lowercase(a[1]));(("color"===r||"background-color"===r)&&(e.match(/^rgb\([0-9%,\. ]*\)$/i)||e.match(/^rgba\([0-9%,\. ]*\)$/i)||e.match(/^hsl\([0-9%,\. ]*\)$/i)||e.match(/^hsla\([0-9%,\. ]*\)$/i)||e.match(/^#[0-9a-f]{3,6}$/i)||e.match(/^[a-z]*$/i))||"text-align"===r&&("left"===e||"right"===e||"center"===e||"justify"===e)||"float"===r&&("left"===e||"right"===e||"none"===e)||("width"===r||"height"===r)&&e.match(/[0-9\.]*(px|em|rem|%)/)||"direction"===r&&e.match(/^ltr|rtl|initial|inherit$/))&&(n+=r+": "+e+";")}}),n}function d(e,t,n,a){return"img"===e&&t["ta-insert-video"]&&("ta-insert-video"===n||"allowfullscreen"===n||"frameborder"===n||"contenteditable"===n&&"false"===a)?!0:!1}function c(e,n){var a=!1,r=t.bind(e,e.push);return{start:function(e,o,i){e=t.lowercase(e),!a&&k[e]&&(a=e),a||D[e]!==!0||(r("<"),r(e),t.forEach(o,function(a,i){var c=t.lowercase(i),u="img"===e&&"src"===c||"background"===c;("style"===c&&""!==(a=s(a))||d(e,o,c,a)||_[c]===!0&&(A[c]!==!0||n(a,u)))&&(r(" "),r(i),r('="'),r(l(a)),r('"'))}),r(i?"/>":">"))},end:function(e){e=t.lowercase(e),a||D[e]!==!0||(r("</"),r(e),r(">")),e==a&&(a=!1)},chars:function(e){a||r(l(e))}}}var u=t.$$minErr("$sanitize"),f=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,p=/^<\/\s*([\w:-]+)[^>]*>/,h=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,g=/^</,m=/^<\//,v=/<!--(.*?)-->/g,y=/<!DOCTYPE([^>]*?)>/i,b=/<!\[CDATA\[(.*?)]]>/g,x=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,w=/([^\#-~| |!])/g,E=r("area,br,col,hr,img,wbr"),C=r("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),S=r("rp,rt"),T=t.extend({},S,C),N=t.extend({},C,r("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),$=t.extend({},S,r("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),R=r("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),k=r("script,style"),D=t.extend({},E,N,$,T,R),A=r("background,cite,href,longdesc,src,usemap,xlink:href"),L=r("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,id,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),M=r("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),_=t.extend({},A,M,L),O=document.createElement("pre"),H=/^(\s*)([\s\S]*?)(\s*)$/,B=function(){return String.prototype.trim?function(e){return t.isString(e)?e.trim():e}:function(e){return t.isString(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}();t.module("ngSanitize",[]).provider("$sanitize",n),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,r=/^mailto:/;return function(o,i){function l(e){e&&p.push(a(e))}function s(e,n){p.push("<a "),t.isDefined(i)&&p.push('target="',i,'" '),p.push('href="',e.replace(/"/g,"&quot;"),'">'),l(n),p.push("</a>")}if(!o)return o;for(var d,c,u,f=o,p=[];d=f.match(n);)c=d[0],d[2]||d[4]||(c=(d[3]?"http://":"mailto:")+c),u=d.index,l(f.substr(0,u)),s(c,d[0].replace(r,"")),f=f.substring(u+d[0].length);return l(f),e(p.join(""))}}])}(window,window.angular)}({},function(){return this}()),!function(e,t){t["true"]=e,angular.module("textAngularSetup",[]).value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},setup:{textEditorSetup:function(){},htmlEditorSetup:function(){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)?(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unqoute selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).run(["taRegisterTool","$window","taTranslations","taSelection",function(e,t,n,a){e("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var r=function(e){return function(){return this.$editor().queryFormatBlockState(e)}},o=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){e(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:n.heading.tooltip+t.charAt(1),action:o,activeState:r(t.toLowerCase())})}),e("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),e("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),e("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),e("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),e("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),e("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),e("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(e){var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t=t||this.$editor().queryCommandState("justifyLeft")}}),e("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){var t=!1;return e&&(t="right"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyRight")}}),e("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){var t=!1;return e&&(t="center"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyCenter")}}),e("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1}}),e("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),e("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),e("strikeThrough",{iconclass:"fa fa-strikethrough",action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),e("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var r=angular.element(a.getSelectionElement()),o=function(e){e=angular.element(e);var t=e;angular.forEach(e.children(),function(e){var n=angular.element("<p></p>");n.html(angular.element(e).html()),t.after(n),t=n}),e.remove()};if(angular.forEach(r.find("ul"),o),angular.forEach(r.find("ol"),o),"li"===r[0].tagName.toLowerCase()){var i=r[0].parentNode.childNodes,l=[],s=[],d=!1;for(n=0;n<i.length;n++)i[n]===r[0]?d=!0:d?s.push(i[n]):l.push(i[n]);var c=angular.element(r[0].parentNode),u=angular.element("<p></p>");if(u.html(angular.element(r[0]).html()),0===l.length||0===s.length)0===s.length?c.after(u):c[0].parentNode.insertBefore(u[0],c[0]),0===l.length&&0===s.length?c.remove():angular.element(r[0]).remove();else{var f=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">"),p=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">");for(n=0;n<l.length;n++)f.append(angular.element(l[n]));for(n=0;n<s.length;n++)p.append(angular.element(s[n]));c.after(p),c.after(u),c.after(f),c.remove()}a.setSelectionToElementEnd(u[0])}var h=this.$editor(),g=function(e){e=angular.element(e),e[0]!==h.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),g)};angular.forEach(r,g),"li"!==r[0].tagName.toLowerCase()&&"ol"!==r[0].tagName.toLowerCase()&&"ul"!==r[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}});var i=function(e,t,n){var a=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var r=n.displayElements.popoverContainer;r.empty();var o=angular.element('<div class="btn-group" style="padding-right: 6px;">'),i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');i.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()});var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()});var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');d.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),o.append(i),o.append(l),o.append(s),o.append(d),r.append(o),o=angular.element('<div class="btn-group" style="padding-right: 6px;">');var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');c.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');u.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()});var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');f.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),o.append(c),o.append(f),o.append(u),r.append(o),o=angular.element('<div class="btn-group">');var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');p.on("click",function(e){e.preventDefault(),t.remove(),a()}),o.append(p),r.append(o),n.showPopover(t),n.showResizeOverlay(t)};e("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var e;return e=t.prompt(n.insertImage.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("insertImage",e,!0):void 0},onElementSelect:{element:"img",action:i}}),e("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var e;if(e=t.prompt(n.insertVideo.dialogPrompt,"https://"),e&&""!==e&&"https://"!==e){var a=e.match(/(\?|&)v=[^&]*/);if(a&&a.length>0){var r="https://www.youtube.com/embed/"+a[0].substring(3),o='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+a[0].substring(3)+'/hqdefault.jpg" ta-insert-video="'+r+'" contenteditable="false" src="" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",o,!0)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:i}}),e("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;return e=t.prompt(n.insertLink.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("createLink",e,!0):void 0},activeState:function(e){return e?"A"===e[0].tagName:!1},onElementSelect:{element:"a",action:function(e,a,r){e.preventDefault(),r.displayElements.popover.css("width","435px");var o=r.displayElements.popoverContainer;o.empty(),o.css("line-height","28px");var i=angular.element('<a href="'+a.attr("href")+'" target="_blank">'+a.attr("href")+"</a>");i.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),o.append(i);var l=angular.element('<div class="btn-group pull-right">'),s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+n.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');
s.on("click",function(e){e.preventDefault();var o=t.prompt(n.insertLink.dialogPrompt,a.attr("href"));o&&""!==o&&"http://"!==o&&(a.attr("href",o),r.updateTaBindtaTextElement()),r.hidePopover()}),l.append(s);var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+n.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');d.on("click",function(e){e.preventDefault(),a.replaceWith(a.contents()),r.updateTaBindtaTextElement(),r.hidePopover()}),l.append(d);var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+n.editLink.targetToggle.buttontext+"</button>");"_blank"===a.attr("target")&&c.addClass("active"),c.on("click",function(e){e.preventDefault(),a.attr("target","_blank"===a.attr("target")?"":"_blank"),c.toggleClass("active"),r.updateTaBindtaTextElement()}),l.append(c),o.append(l),r.showPopover(a)}}}),e("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words:{{wordcount}}</div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerHTML,n=t.replace(/(<[^>]*?>)/gi," "),a=n.match(/\S+/g),r=a&&a.length||0;return this.wordcount=r,this.$editor().wordcount=r,!1}}),e("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters:{{charcount}}</div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerText||e[0].textContent,n=t.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=n,this.$editor().charcount=n,!1}})}]),function(){"Use Strict";function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(t,n){if(!t||""===t||m.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(n.display&&(""===n.display||!e(n.display))||!n.display&&!n.buttontext&&!n.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';m[t]=n}var n={ie:function(){for(var e,t=3,n=document.createElement("div"),a=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",a[0];);return t>4?t:e}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},a=!1;n.webkit&&(document.addEventListener("mousedown",function(e){var t=e||window.event,n=t.target;if(a&&null!==n){for(var r=!1,o=n;null!==o&&"html"!==o.tagName.toLowerCase()&&!r;)r="true"===o.contentEditable,o=o.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),n.focus(),n.select&&n.select())}a=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" unselectable="on" tabIndex="-1">'))}));var r=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,o=/^(ul|li|ol)$/i,i=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var l,s,d,c,u;if(n.ie>8||void 0===n.ie){for(var f=document.styleSheets,p=0;p<f.length;p++)if((0===f[p].media.length||f[p].media.mediaText.match(/(all|screen)/gi))&&f[p].href&&f[p].href.match(/textangular\.(min\.|)css/gi)){l=f[p];break}l||(l=function(){var e=document.createElement("style");return n.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),s=function(e,t){return c(l,e,t)},c=function(e,t,n){var a;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),a},d=function(e){u(l,e)},u=function(e,t){e.removeRule?e.removeRule(t):e.deleteRule(t)}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===n.ie?"div":n.ie<=8?"P":"p":n.ie<=8?e.toUpperCase():e:n.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(e,t){return function(n){var a=angular.element("<div></div>");return a[0].innerHTML=n,angular.forEach(e,function(e){var n=[];e.selector&&""!==e.selector?n=a.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(n=t.getByAttribute(a,e.customAttribute)),angular.forEach(n,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),a[0].innerHTML}}]).factory("taFixChrome",function(){var e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n,a,r=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,o="",i=0;t=r.exec(e);)n=t[3]||t[4],n&&n.match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,""),a="<"+t[1].trim(),n.length>0&&(a+=" style="+t[2].substring(0,1)+n+t[2].substring(0,1)),a+=t[5].trim()+">",o+=e.substring(i,t.index)+a,i=t.index+t[0].length);return o+=e.substring(i),i>0?o.replace(/<span\s*>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e};return e}).factory("taSanitize",["$sanitize","taDOM",function(e){function t(e,t){for(var n,a=0,r=0,o=/<[^>]*>/gi;n=o.exec(e);)if(r=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,r)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(r)}function n(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var a,o,i,l,d,c=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,u="",f="",p=0;o=c.exec(e);){i=o[3]||o[4];var h=new RegExp(s,"i");if(angular.isString(i)&&h.test(i)){l="";for(var g=new RegExp(s,"ig");subMatch=g.exec(i);)for(a=0;a<r.length;a++)subMatch[2*a+2]&&(l+="<"+r[a].tag+">");d=n(e.substring(p,o.index)),f+=u.length>0?t(d,u):d,i=i.replace(new RegExp(s,"ig"),""),f+="<"+o[1].trim(),i.length>0&&(f+=' style="'+i+'"'),f+=o[5]+">",p=o.index+o[0].length,u=l}}return f+=u.length>0?t(e.substring(p),u):e.substring(p)}function a(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",r=0;t=n.exec(e);)a+=e.substring(r,t.index),r=t.index+t[0].length,newTag="<"+t[1]+t[5],/style=("([^"]+)"|'([^']+)')/gi.test(newTag)?newTag=newTag.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):newTag+=' style="text-align:'+(t[3]||t[4])+';"',newTag+=">",a+=newTag;return a+e.substring(r)}for(var r=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],o=[],i=0;i<r.length;i++){var l="("+r[i].property+":\\s*(";for(j=0;j<r[i].values.length;j++)j>0&&(l+="|"),l+=r[i].values[j];l+=");)",o.push(l)}var s="("+o.join("|")+")";return function(t,r,o){if(!o)try{t=n(t)}catch(i){}t=a(t);var l;try{l=e(t),o&&(l=t)}catch(i){l=r||""}var s=l.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi);processedSafe=l.replace(/(&#(9|10);)*/gi,"");var d,c=/<pre[^>]*>.*?<\/pre[^>]*>/gi,u=0,f=0;for(l="";null!==(d=c.exec(processedSafe))&&u<s.length;)l+=processedSafe.substring(f,d.index)+s[u],f=d.index+d[0].length,u++;return l+processedSafe.substring(f)}}]).factory("taToolExecuteAction",["$q","$log",function(e,t){return function(n){void 0!==n&&(this.$editor=function(){return n});var a=e.defer(),r=a.promise,o=this.$editor();r["finally"](function(){o.endAction.call(o)});var i;try{i=this.action(a,o.startAction())}catch(l){t.error(l)}(i||void 0===i)&&a.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,n){var a=function(t,n){var a,r,o=t.find("li");for(r=o.length-1;r>=0;r--)a=angular.element("<"+n+">"+o[r].innerHTML+"</"+n+">"),t.after(a);t.remove(),e.setSelectionToElementEnd(a[0])},i=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?e.setSelectionBeforeElement(angular.element(t).find("br")[0]):e.setSelectionToElementEnd(t)},l=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),i(n.find("li")[0])},s=function(e,n,a){for(var r="",o=0;o<e.length;o++)r+="<"+t("li")+">"+e[o].innerHTML+"</"+t("li")+">";var l=angular.element("<"+a+">"+r+"</"+a+">");n.after(l),n.remove(),i(l.find("li")[0])};return function(i,d){return i=t(i),function(c,u,f){var p,h,g,m,v,y,b,x=angular.element("<"+i+">");try{b=e.getSelectionElement()}catch(w){}var E=angular.element(b);if(void 0!==b){var C=b.tagName.toLowerCase();if("insertorderedlist"===c.toLowerCase()||"insertunorderedlist"===c.toLowerCase()){var S=t("insertorderedlist"===c.toLowerCase()?"ol":"ul");if(C===S)return a(E,i);if("li"===C&&E.parent()[0].tagName.toLowerCase()===S&&1===E.parent().children().length)return a(E.parent(),i);if("li"===C&&E.parent()[0].tagName.toLowerCase()!==S&&1===E.parent().children().length)return l(E.parent(),S);if(C.match(r)&&!E.hasClass("ta-bind")){if("ol"===C||"ul"===C)return l(E,S);var T=!1;return angular.forEach(E.children(),function(e){e.tagName.match(r)&&(T=!0)}),T?s(E.children(),E,S):s([angular.element("<div>"+b.innerHTML+"</div>")[0]],E,S)}if(C.match(r)){if(m=e.getOnlySelectedElements(),0===m.length)h=angular.element("<"+S+"><li>"+b.innerHTML+"</li></"+S+">"),E.html(""),E.append(h);else{if(1===m.length&&("ol"===m[0].tagName.toLowerCase()||"ul"===m[0].tagName.toLowerCase()))return m[0].tagName.toLowerCase()===S?a(angular.element(m[0]),i):l(angular.element(m[0]),S);g="";var N=[];for(p=0;p<m.length;p++)if(3!==m[p].nodeType){var $=angular.element(m[p]);if("li"===m[p].tagName.toLowerCase())continue;g+="ol"===m[p].tagName.toLowerCase()||"ul"===m[p].tagName.toLowerCase()?$[0].innerHTML:"span"!==m[p].tagName.toLowerCase()||"ol"!==m[p].childNodes[0].tagName.toLowerCase()&&"ul"!==m[p].childNodes[0].tagName.toLowerCase()?"<"+t("li")+">"+$[0].innerHTML+"</"+t("li")+">":$[0].childNodes[0].innerHTML,N.unshift($)}h=angular.element("<"+S+">"+g+"</"+S+">"),N.pop().replaceWith(h),angular.forEach(N,function(e){e.remove()})}return void e.setSelectionToElementEnd(h[0])}}else{if("formatblock"===c.toLowerCase()){for(y=f.toLowerCase().replace(/[<>]/gi,""),"default"===y.trim()&&(y=i,f="<"+i+">"),h="li"===C?E.parent():E;!h[0].tagName||!h[0].tagName.match(r)&&!h.parent().attr("contenteditable");)h=h.parent(),C=(h[0].tagName||"").toLowerCase();if(C===y){m=h.children();var R=!1;for(p=0;p<m.length;p++)R=R||m[p].tagName.match(r);R?(h.after(m),v=h.next(),h.remove(),h=v):(x.append(h[0].childNodes),h.after(x),h.remove(),h=x)}else if(h.parent()[0].tagName.toLowerCase()!==y||h.parent().hasClass("ta-bind"))if(C.match(o))h.wrap(f);else{for(m=e.getOnlySelectedElements(),0===m.length&&(m=[h[0]]),p=0;p<m.length;p++)if(3===m[p].nodeType||!m[p].tagName.match(r))for(;3===m[p].nodeType||!m[p].tagName||!m[p].tagName.match(r);)m[p]=m[p].parentNode;if(angular.element(m[0]).hasClass("ta-bind"))h=angular.element(f),h[0].innerHTML=m[0].innerHTML,m[0].innerHTML=h[0].outerHTML;else if("blockquote"===y){for(g="",p=0;p<m.length;p++)g+=m[p].outerHTML;for(h=angular.element(f),h[0].innerHTML=g,m[0].parentNode.insertBefore(h[0],m[0]),p=m.length-1;p>=0;p--)m[p].parentNode&&m[p].parentNode.removeChild(m[p])}else for(p=0;p<m.length;p++)h=angular.element(f),h[0].innerHTML=m[p].innerHTML,m[p].parentNode.insertBefore(h[0],m[p]),m[p].parentNode.removeChild(m[p])}else{var k=h.parent(),D=k.contents();for(p=0;p<D.length;p++)k.parent().hasClass("ta-bind")&&3===D[p].nodeType&&(x=angular.element("<"+i+">"),x[0].innerHTML=D[p].outerHTML,D[p]=x[0]),k.parent()[0].insertBefore(D[p],k[0]);k.remove()}return void e.setSelectionToElementEnd(h[0])}if("createlink"===c.toLowerCase()){var A=e.getSelection();if(A.collapsed)return void e.insertHtml('<a href="'+f+'">'+f+"</a>",d)}else if("inserthtml"===c.toLowerCase())return void e.insertHtml(f,d)}}try{n[0].execCommand(c,u,f)}catch(w){}}}}]).service("taSelection",["$window","$document","taDOM",function(e,t,n){var a=t[0],o=e.rangy,l=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},s={getSelection:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer,n={start:l(e.startContainer,e.startOffset),end:l(e.endContainer,e.endOffset),collapsed:e.collapsed};return t=3===t.nodeType?t.parentNode:t,n.container=t.parentNode===n.start.element||t.parentNode===n.end.element?t.parentNode:t,n},getOnlySelectedElements:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getSelectionElement:function(){return s.getSelection().container},setSelection:function(e,t,n){var a=o.createRange();a.setStart(e,t),a.setEnd(e,n),o.getSelection().setSingleRange(a)},setSelectionBeforeElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!1),o.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),o.getSelection().setSingleRange(t)},insertHtml:function(e,t){var l,d,c,u,f,p,h,g=angular.element("<div>"+e+"</div>"),m=o.getSelection().getRangeAt(0),v=a.createDocumentFragment(),y=g[0].childNodes,b=!0;if(y.length>0){for(u=[],c=0;c<y.length;c++)"p"===y[c].nodeName.toLowerCase()&&""===y[c].innerHTML.trim()||3===y[c].nodeType&&""===y[c].nodeValue.trim()||(b=b&&!r.test(y[c].nodeName),u.push(y[c]));for(var x=0;x<u.length;x++)p=v.appendChild(u[x]);!b&&m.collapsed&&/^(|<br(|\/)>)$/i.test(m.startContainer.innerHTML)&&m.selectNode(m.startContainer)}else b=!0,p=v=a.createTextNode(e);if(b)m.deleteContents();else if(m.collapsed&&m.startContainer!==t)if(m.startContainer.innerHTML&&m.startContainer.innerHTML.match(/^<[^>]*>$/i))l=m.startContainer,1===m.startOffset?(m.setStartAfter(l),m.setEndAfter(l)):(m.setStartBefore(l),m.setEndBefore(l));else{if(3===m.startContainer.nodeType&&m.startContainer.parentNode!==t)for(l=m.startContainer.parentNode,d=l.cloneNode(),n.splitNodes(l.childNodes,l,d,m.startContainer,m.startOffset);!i.test(l.nodeName);){angular.element(l).after(d),l=l.parentNode;var w=d;d=l.cloneNode(),n.splitNodes(l.childNodes,l,d,w)}else l=m.startContainer,d=l.cloneNode(),n.splitNodes(l.childNodes,l,d,void 0,void 0,m.startOffset);if(angular.element(l).after(d),m.setStartAfter(l),m.setEndAfter(l),/^(|<br(|\/)>)$/i.test(l.innerHTML.trim())&&(m.setStartBefore(l),m.setEndBefore(l),angular.element(l).remove()),/^(|<br(|\/)>)$/i.test(d.innerHTML.trim())&&angular.element(d).remove(),"li"===l.nodeName.toLowerCase()){for(h=a.createDocumentFragment(),f=0;f<v.childNodes.length;f++)g=angular.element("<li>"),n.transferChildNodes(v.childNodes[f],g[0]),n.transferNodeAttributes(v.childNodes[f],g[0]),h.appendChild(g[0]);v=h,p&&(p=v.childNodes[v.childNodes.length-1],p=p.childNodes[p.childNodes.length-1])}}else m.deleteContents();m.insertNode(v),p&&s.setSelectionToElementEnd(p)}};return s}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var a=[],r=t.children();return r.length&&angular.forEach(r,function(t){a=a.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&a.push(t),a},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,a,r,o,i){if(!r&&isNaN(i))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var l=document.createDocumentFragment(),s=document.createDocumentFragment(),d=0;t.length>0&&(isNaN(i)||i!==d)&&t[0]!==r;)l.appendChild(t[0]),d++;for(!isNaN(o)&&o>=0&&t[0]&&(l.appendChild(document.createTextNode(t[0].nodeValue.substring(0,o))),t[0].nodeValue=t[0].nodeValue.substring(o));t.length>0;)s.appendChild(t[0]);e.transferChildNodes(l,n),e.transferChildNodes(s,a)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){function r(e){var t=angular.element("<div/>");t.html(e);var n=t.text().length;return o>=n?(a.$setValidity("taMaxText",!0),e):void a.$setValidity("taMaxText",!1)}var o=parseInt(e.$eval(n.taMaxText));if(isNaN(o))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";a.$dirty&&a.$setViewValue(a.$viewValue)}),a.$parsers.unshift(r)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){function r(e){var t=angular.element("<div/>");t.html(e);var n=t.text().length;return!n||n>=o?(a.$setValidity("taMinText",!0),e):void a.$setValidity("taMinText",!1)}var o=parseInt(e.$eval(n.taMinText));if(isNaN(o))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";a.$dirty&&a.$setViewValue(a.$viewValue)}),a.$parsers.unshift(r)}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var e=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(n){if(!n)return!0;var a,r=/(^[^<]|>)[^<]/i.exec(n);return r?a=r.index:(n=n.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),a=n.indexOf(">")),n=n.trim().substring(a,a+100),/^[^<>]+$/i.test(n)?!1:0===n.length||n===t||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(n)?!0:/>\s*[^\s<]/i.test(n)||e.test(n)?!1:!0}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM",function(e,t,r,o,l,c,u,f,p,g,m,v,y){return{require:"ngModel",link:function(c,b,x,w){var E,C,S,T,N=void 0!==b.attr("contenteditable")&&b.attr("contenteditable"),$=N||"textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase(),R=!1,k=!1,D=!1,A=x.taUnsafeSanitizer||g.disableSanitizer,L=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,M=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i;void 0===x.taDefaultWrap&&(x.taDefaultWrap="p"),""===x.taDefaultWrap?(S="",T=void 0===n.ie?"<div><br></div>":n.ie>=11?"<p><br></p>":n.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(S=void 0===n.ie||n.ie>=11?"<"+x.taDefaultWrap+"><br></"+x.taDefaultWrap+">":n.ie<=8?"<"+x.taDefaultWrap.toUpperCase()+"></"+x.taDefaultWrap.toUpperCase()+">":"<"+x.taDefaultWrap+"></"+x.taDefaultWrap+">",T=void 0===n.ie||n.ie>=11?"<"+x.taDefaultWrap+"><br></"+x.taDefaultWrap+">":n.ie<=8?"<"+x.taDefaultWrap.toUpperCase()+">&nbsp;</"+x.taDefaultWrap.toUpperCase()+">":"<"+x.taDefaultWrap+">&nbsp;</"+x.taDefaultWrap+">");var _=m(T);x.taPaste&&(C=v(x.taPaste)),b.addClass("ta-bind");var O;c["$undoManager"+(x.id||"")]=w.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return"undefined"==typeof e||null===e||"undefined"!=typeof this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),O&&t.cancel(O),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var H=c["$undoTaBind"+(x.id||"")]=function(){if(!R&&N){var e=w.$undoManager.undo();"undefined"!=typeof e&&null!==e&&(Q(e),P(e,!1),u.setSelectionToElementEnd(b[0].childNodes.length?b[0].childNodes[b[0].childNodes.length-1]:b[0]))}},B=c["$redoTaBind"+(x.id||"")]=function(){if(!R&&N){var e=w.$undoManager.redo();"undefined"!=typeof e&&null!==e&&(Q(e),P(e,!1),u.setSelectionToElementEnd(b[0].childNodes.length?b[0].childNodes[b[0].childNodes.length-1]:b[0]))}},I=function(){if(N)return b[0].innerHTML;if($)return b.val();throw"textAngular Error: attempting to update non-editable taBind"},P=function(e,t){D=!0,("undefined"==typeof t||null===t)&&(t=!0&&N),("undefined"==typeof e||null===e)&&(e=I()),_(e)?(""!==w.$viewValue&&w.$setViewValue(""),t&&""!==w.$undoManager.current()&&w.$undoManager.push("")):(Y(),w.$viewValue!==e&&(w.$setViewValue(e),t&&w.$undoManager.push(e)))};if(c["updateTaBind"+(x.id||"")]=function(){R||P()},$)if(c.events={},N){var q=!1,W=function(n){if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)){var a=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);a=a?a[1]:n,a=a.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var r=angular.element("<div>"+a+"</div>"),o=angular.element("<div></div>"),i={element:null,lastIndent:[],lastLi:null,isUl:!1};i.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var l=function(e){i.isUl=e,i.element=angular.element(e?"<ul>":"<ol>"),i.lastIndent=[],i.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},i.lastLevelMatch=null},s=0;s<=r[0].childNodes.length;s++)if(r[0].childNodes[s]&&"#text"!==r[0].childNodes[s].nodeName&&"p"===r[0].childNodes[s].tagName.toLowerCase()){var d=angular.element(r[0].childNodes[s]),f=(d.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(f){if(d[0].childNodes.length<2||d[0].childNodes[1].childNodes.length<1)continue;var p="bullet"===f[1].toLowerCase()||"number"!==f[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].childNodes[0].innerHTML)),h=(d.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),g=parseFloat(h?h[1]:0),m=(d.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(m&&m[2]&&(g=parseInt(m[2])),m&&(!i.lastLevelMatch||m[1]!==i.lastLevelMatch[1])||!f[3]||"first"===f[3].toLowerCase()||null===i.lastIndent.peek()||i.isUl!==p&&i.lastIndent.peek()===g)l(p),o.append(i.element);else if(null!=i.lastIndent.peek()&&i.lastIndent.peek()<g)i.element=angular.element(p?"<ul>":"<ol>"),i.lastLi.append(i.element);else if(null!=i.lastIndent.peek()&&i.lastIndent.peek()>g){for(;null!=i.lastIndent.peek()&&i.lastIndent.peek()>g;)if("li"!==i.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(i.element.parent()[0].tagName.toLowerCase()))break;i.element=i.element.parent(),i.lastIndent.pop()}else i.element=i.element.parent();i.isUl="ul"===i.element[0].tagName.toLowerCase(),p!==i.isUl&&(l(p),o.append(i.element))}i.lastLevelMatch=m,g!==i.lastIndent.peek()&&i.lastIndent.push(g),i.lastLi=angular.element("<li>"),i.element.append(i.lastLi),i.lastLi.html(d.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),d.remove()}else l(!1),o.append(d)}var v=function(e){e=angular.element(e);for(var t=e[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(o.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&v(e)}),angular.forEach(o.find("font"),v),n=o.html()}else{if(n=n.replace(/<(|\/)meta[^>]*?>/gi,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){var x=angular.element("<div>"+n+"</div>");x.find("textarea").remove();for(var E=y.getByAttribute(x,"ta-bind"),S=0;S<E.length;S++){for(var T=E[S][0].parentNode.parentNode,N=0;N<E[S][0].childNodes.length;N++)T.parentNode.insertBefore(E[S][0].childNodes[N],T);T.parentNode.removeChild(T)}n=x.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n=n.replace(/<(|\/)span[^>]*?>/gi,""));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}n=e(n,"",A),C&&(n=C(c,{$html:n})||n),u.insertHtml(n,b[0]),t(function(){w.$setViewValue(I()),q=!1,b.removeClass("processing-paste")},0)}else q=!1,b.removeClass("processing-paste")};if(b.on("paste",c.events.paste=function(e,n){if(n&&angular.extend(e,n),R||q)return e.stopPropagation(),e.preventDefault(),!1;q=!0,b.addClass("processing-paste");var a,i=(e.originalEvent||e).clipboardData;if(i&&i.getData){for(var l="",s=0;s<i.types.length;s++)l+=" "+i.types[s];return/text\/html/i.test(l)?a=i.getData("text/html"):/text\/plain/i.test(l)&&(a=i.getData("text/plain")),W(a),e.stopPropagation(),e.preventDefault(),!1}var d=r.rangy.saveSelection(),c=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');o.find("body").append(c),c[0].focus(),t(function(){r.rangy.restoreSelection(d),W(c[0].innerHTML),c.remove(),b[0].focus()},0)}),b.on("cut",c.events.cut=function(e){R?e.preventDefault():t(function(){w.$setViewValue(I())},0)}),b.on("keydown",c.events.keydown=function(e,t){if(t&&angular.extend(e,t),!R)if(!e.altKey&&e.metaKey||e.ctrlKey)90!==e.keyCode||e.shiftKey?(90===e.keyCode&&e.shiftKey||89===e.keyCode&&!e.shiftKey)&&(B(),e.preventDefault()):(H(),e.preventDefault());else if(13===e.keyCode&&!e.shiftKey){var n=u.getSelectionElement();if(!n.tagName.match(i))return;var a=angular.element(S);if(/^<br(|\/)>$/i.test(n.innerHTML.trim())&&"blockquote"===n.parentNode.tagName.toLowerCase()&&!n.nextSibling){$selection=angular.element(n);var r=$selection.parent();r.after(a),$selection.remove(),0===r.children().length&&r.remove(),u.setSelectionToElementStart(a[0]),e.preventDefault()}else/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(n.innerHTML.trim())&&"blockquote"===n.tagName.toLowerCase()&&($selection=angular.element(n),$selection.after(a),$selection.remove(),u.setSelectionToElementStart(a[0]),e.preventDefault())}}),b.on("keyup",c.events.keyup=function(e,n){if(n&&angular.extend(e,n),O&&t.cancel(O),!R&&!L.test(e.keyCode)){if(""!==S&&13===e.keyCode&&!e.shiftKey){for(var a=u.getSelectionElement();!a.tagName.match(i)&&a!==b[0];)a=a.parentNode;if(a.tagName.toLowerCase()!==x.taDefaultWrap&&"li"!==a.tagName.toLowerCase()&&(""===a.innerHTML.trim()||"<br>"===a.innerHTML.trim())){var o=angular.element(S);angular.element(a).replaceWith(o),u.setSelectionToElementStart(o[0])}}var l=I();if(""!==S&&""===l.trim())Q(S),u.setSelectionToElementStart(b.children()[0]);else if("<"!==l.substring(0,1)&&""!==x.taDefaultWrap){var s=r.rangy.saveSelection();l=I(),l="<"+x.taDefaultWrap+">"+l+"</"+x.taDefaultWrap+">",Q(l),r.rangy.restoreSelection(s)}var d=E!==e.keyCode&&M.test(e.keyCode);P(l,d),d||(O=t(function(){w.$undoManager.push(l)},250)),E=e.keyCode}}),b.on("blur",c.events.blur=function(){k=!1,R||P(),D=!0,w.$render()}),x.placeholder&&(n.ie>8||void 0===n.ie)){var z;if(!x.id)throw"textAngular Error: An unique ID is required for placeholders to work";z=s("#"+x.id+".placeholder-text:before",'content: "'+x.placeholder+'"'),c.$on("$destroy",function(){d(z)})}b.on("focus",c.events.focus=function(){k=!0,b.removeClass("placeholder-text")}),b.on("mouseup",c.events.mouseup=function(){var e=u.getSelection();e.start.element===b[0]&&b.children().length&&u.setSelectionToElementStart(b.children()[0])}),b.on("mousedown",c.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{b.on("change blur",c.events.change=c.events.blur=function(){R||w.$setViewValue(I())}),b.on("keydown",c.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,r=b.val();if(e.shiftKey){var o=r.lastIndexOf("\n",n),i=r.lastIndexOf("	",n);-1!==i&&i>=o&&(b.val(r.substring(0,i)+r.substring(i+1)),this.selectionStart=this.selectionEnd=n-1)}else b.val(r.substring(0,n)+"	"+r.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var F=function(e,t){for(var n="",a=0;t>a;a++)n+=e;return n},V=function(e,t){var n="",a=e.childNodes;t++,n+=F("	",t-1)+e.outerHTML.substring(0,e.outerHTML.indexOf("<li"));for(var r=0;r<a.length;r++)a[r].outerHTML&&(n+="ul"===a[r].nodeName.toLowerCase()||"ol"===a[r].nodeName.toLowerCase()?"\n"+V(a[r],t):"\n"+F("	",t)+a[r].outerHTML);return n+="\n"+F("	",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};w.$formatters.unshift(function(e){var t=angular.element("<div>"+e+"</div>")[0].childNodes;if(t.length>0){e="";for(var n=0;n<t.length;n++)t[n].outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===t[n].nodeName.toLowerCase()||"ol"===t[n].nodeName.toLowerCase()?""+V(t[n],0):""+t[n].outerHTML)}return e})}var U=function(t){return w.$oldViewValue=e(l(t),w.$oldViewValue,A)},j=function(e){return x.required&&w.$setValidity("required",!_(e)),e};w.$parsers.push(U),w.$parsers.unshift(j),w.$formatters.push(U),w.$formatters.unshift(function(e){if(_(e))return e;var t=angular.element("<div>"+e+"</div>");return 0===t.children().length&&(e="<"+x.taDefaultWrap+">"+e+"</"+x.taDefaultWrap+">"),e}),w.$formatters.unshift(j),w.$formatters.unshift(function(e){return w.$undoManager.push(e||"")});var K=function(e){return c.$emit("ta-element-select",this),e.preventDefault(),!1},G=function(e,n){if(n&&angular.extend(e,n),!h&&!R){h=!0;var a;a=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,c.$emit("ta-drop-event",this,e,a),t(function(){h=!1,P()},100)}},Y=c["reApplyOnSelectorHandlers"+(x.id||"")]=function(){R||angular.forEach(f,function(e){b.find(e).off("click",K).on("click",K)})},Q=function(e){b[0].innerHTML=e};w.$render=function(){var e=w.$viewValue||"";D||(N&&k&&(b.removeClass("placeholder-text"),b[0].blur(),t(function(){b[0].focus(),u.setSelectionToElementEnd(b.children()[b.children().length-1])},1)),N?(Q(x.placeholder?""===e?S:e:""===e?S:e),R?b.off("drop",G):(Y(),b.on("drop",G))):"textarea"!==b[0].tagName.toLowerCase()&&"input"!==b[0].tagName.toLowerCase()?Q(p(e)):b.val(e)),N&&x.placeholder&&(""===e?k?b.removeClass("placeholder-text"):b.addClass("placeholder-text"):b.removeClass("placeholder-text")),D=!1},x.taReadonly&&(R=c.$eval(x.taReadonly),R?(b.addClass("ta-readonly"),("textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase())&&b.attr("disabled","disabled"),void 0!==b.attr("contenteditable")&&b.attr("contenteditable")&&b.removeAttr("contenteditable")):(b.removeClass("ta-readonly"),"textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase()?b.removeAttr("disabled"):N&&b.attr("contenteditable","true")),c.$watch(x.taReadonly,function(e,t){t!==e&&(e?(b.addClass("ta-readonly"),("textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase())&&b.attr("disabled","disabled"),void 0!==b.attr("contenteditable")&&b.attr("contenteditable")&&b.removeAttr("contenteditable"),angular.forEach(f,function(e){b.find(e).on("click",K)}),b.off("drop",G)):(b.removeClass("ta-readonly"),"textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase()?b.removeAttr("disabled"):N&&b.attr("contenteditable","true"),angular.forEach(f,function(e){b.find(e).off("click",K)}),b.on("drop",G)),R=e)})),N&&!R&&(angular.forEach(f,function(e){b.find(e).on("click",K)}),b.on("drop",G),b.on("blur",function(){n.webkit&&(a=!0)}))}}}]);var h=!1,g=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]),m={};g.constant("taRegisterTool",t),g.value("taTools",m),g.config([function(){angular.forEach(m,function(e,t){delete m[t]
})}]),g.run([function(){if(!window.rangy)throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly."}]),g.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(e,t,n,a,r,o,i,l,s,d,c,u){return{require:"?ngModel",scope:{},restrict:"EA",link:function(f,p,h,g){var m,v,y,b,x,w,E,C,S,T,N=h.serial?h.serial:Math.floor(1e16*Math.random());f._name=h.name?h.name:"textAngularEditor"+N;var $=function(e,n,a){t(function(){var t=function(){e.off(n,t),a.apply(this,arguments)};e.on(n,t)},100)};S=r(h.taDefaultWrap),angular.extend(f,angular.copy(n),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?f["$undoTaBindtaTextElement"+N]():"redo"===e.toLowerCase()?f["$redoTaBindtaTextElement"+N]():(S(e,!1,t),n&&f["reApplyOnSelectorHandlerstaTextElement"+N](),f.displayElements.text[0].focus())},showHtml:f.$eval(h.taShowHtml)||!1}),h.taFocussedClass&&(f.classes.focussed=h.taFocussedClass),h.taTextEditorClass&&(f.classes.textEditor=h.taTextEditorClass),h.taHtmlEditorClass&&(f.classes.htmlEditor=h.taHtmlEditorClass),h.taTextEditorSetup&&(f.setup.textEditorSetup=f.$parent.$eval(h.taTextEditorSetup)),h.taHtmlEditorSetup&&(f.setup.htmlEditorSetup=f.$parent.$eval(h.taHtmlEditorSetup)),f.fileDropHandler=h.taFileDrop?f.$parent.$eval(h.taFileDrop):f.defaultFileDropHandler,E=p[0].innerHTML,p[0].innerHTML="",f.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea name='descripcion2' required></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},f.displayElements.popover.append(f.displayElements.popoverArrow),f.displayElements.popover.append(f.displayElements.popoverContainer),f.displayElements.scrollWindow.append(f.displayElements.popover),f.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),f.showPopover=function(e){f.displayElements.popover.css("display","block"),f.reflowPopover(e),s.addClass(f.displayElements.popover,"in"),$(l.find("body"),"click keyup",function(){f.hidePopover()})},f.reflowPopover=function(e){f.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(f.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+"px"),f.displayElements.popover.removeClass("top").addClass("bottom")):(f.displayElements.popover.css("top",e[0].offsetTop-54+"px"),f.displayElements.popover.removeClass("bottom").addClass("top"));var t=f.displayElements.text[0].offsetWidth-f.displayElements.popover[0].offsetWidth,n=e[0].offsetLeft+e[0].offsetWidth/2-f.displayElements.popover[0].offsetWidth/2;f.displayElements.popover.css("left",Math.max(0,Math.min(t,n))+"px"),f.displayElements.popoverArrow.css("margin-left",Math.min(n,Math.max(0,n-t))-11+"px")},f.hidePopover=function(){var e=function(){f.displayElements.popover.css("display",""),f.displayElements.popoverContainer.attr("style",""),f.displayElements.popoverContainer.attr("class","popover-content")};c.when(s.removeClass(f.displayElements.popover,"in",e)).then(e)},f.displayElements.resize.overlay.append(f.displayElements.resize.background),angular.forEach(f.displayElements.resize.anchors,function(e){f.displayElements.resize.overlay.append(e)}),f.displayElements.resize.overlay.append(f.displayElements.resize.info),f.displayElements.scrollWindow.append(f.displayElements.resize.overlay),f.reflowResizeOverlay=function(e){e=angular.element(e)[0],f.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),f.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},f.showResizeOverlay=function(e){var t=l.find("body");T=function(n){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:n.clientX,y:n.clientY};(void 0===a.width||isNaN(a.width))&&(a.width=e[0].offsetWidth),(void 0===a.height||isNaN(a.height))&&(a.height=e[0].offsetHeight),f.hidePopover();var r=a.height/a.width,o=function(t){var n={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))};if(t.shiftKey){var o=n.y/n.x;n.x=r>o?n.x:n.y/r,n.y=r>o?n.x*r:n.y}el=angular.element(e),el.attr("height",Math.max(0,n.y)),el.attr("width",Math.max(0,n.x)),f.reflowResizeOverlay(e)};t.on("mousemove",o),$(t,"mouseup",function(n){n.preventDefault(),n.stopPropagation(),t.off("mousemove",o),f.showPopover(e)}),n.stopPropagation(),n.preventDefault()},f.displayElements.resize.anchors[3].on("mousedown",T),f.reflowResizeOverlay(e),$(t,"click",function(){f.hideResizeOverlay()})},f.hideResizeOverlay=function(){f.displayElements.resize.anchors[3].off("mousedown",T),f.displayElements.resize.overlay.css("display","")},f.setup.htmlEditorSetup(f.displayElements.html),f.setup.textEditorSetup(f.displayElements.text),f.displayElements.html.attr({id:"taHtmlElement"+N,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),f.displayElements.text.attr({id:"taTextElement"+N,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),f.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),h.taDefaultWrap&&f.displayElements.text.attr("ta-default-wrap",h.taDefaultWrap),h.taUnsafeSanitizer&&(f.displayElements.text.attr("ta-unsafe-sanitizer",h.taUnsafeSanitizer),f.displayElements.html.attr("ta-unsafe-sanitizer",h.taUnsafeSanitizer)),f.displayElements.scrollWindow.append(f.displayElements.text),p.append(f.displayElements.scrollWindow),p.append(f.displayElements.html),f.displayElements.forminput.attr("name",f._name),p.append(f.displayElements.forminput),h.tabindex&&(p.removeAttr("tabindex"),f.displayElements.text.attr("tabindex",h.tabindex),f.displayElements.html.attr("tabindex",h.tabindex)),h.placeholder&&(f.displayElements.text.attr("placeholder",h.placeholder),f.displayElements.html.attr("placeholder",h.placeholder)),h.taDisabled&&(f.displayElements.text.attr("ta-readonly","disabled"),f.displayElements.html.attr("ta-readonly","disabled"),f.disabled=f.$parent.$eval(h.taDisabled),f.$parent.$watch(h.taDisabled,function(e){f.disabled=e,f.disabled?p.addClass(f.classes.disabled):p.removeClass(f.classes.disabled)})),h.taPaste&&(f._pasteHandler=function(e){return u(h.taPaste)(f.$parent,{$html:e})},f.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(f.displayElements.scrollWindow)(f),e(f.displayElements.html)(f),f.updateTaBindtaTextElement=f["updateTaBindtaTextElement"+N],f.updateTaBindtaHtmlElement=f["updateTaBindtaHtmlElement"+N],p.addClass("ta-root"),f.displayElements.scrollWindow.addClass("ta-text ta-editor "+f.classes.textEditor),f.displayElements.html.addClass("ta-html ta-editor "+f.classes.htmlEditor),f._actionRunning=!1;var R=!1;if(f.startAction=function(){return f._actionRunning=!0,R=i.rangy.saveSelection(),function(){R&&i.rangy.restoreSelection(R)}},f.endAction=function(){f._actionRunning=!1,R&&i.rangy.removeMarkers(R),R=!1,f.updateSelectedStyles(),f.showHtml||f["updateTaBindtaTextElement"+N]()},x=function(){f.focussed=!0,p.addClass(f.classes.focussed),C.focus(),p.triggerHandler("focus")},f.displayElements.html.on("focus",x),f.displayElements.text.on("focus",x),w=function(e){return f._actionRunning||l[0].activeElement===f.displayElements.html[0]||l[0].activeElement===f.displayElements.text[0]||(p.removeClass(f.classes.focussed),C.unfocus(),t(function(){f._bUpdateSelectedStyles=!1,p.triggerHandler("blur"),f.focussed=!1},0)),e.preventDefault(),!1},f.displayElements.html.on("blur",w),f.displayElements.text.on("blur",w),f.displayElements.text.on("paste",function(e){p.triggerHandler("paste",e)}),f.queryFormatBlockState=function(e){return!f.showHtml&&e.toLowerCase()===l[0].queryCommandValue("formatBlock").toLowerCase()},f.queryCommandState=function(e){return f.showHtml?"":l[0].queryCommandState(e)},f.switchView=function(){f.showHtml=!f.showHtml,s.enabled(!1,f.displayElements.html),s.enabled(!1,f.displayElements.text),f.showHtml?t(function(){return s.enabled(!0,f.displayElements.html),s.enabled(!0,f.displayElements.text),f.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,f.displayElements.html),s.enabled(!0,f.displayElements.text),f.displayElements.text[0].focus()},100)},h.ngModel){var k=!0;g.$render=function(){if(k){k=!1;var e=f.$parent.$eval(h.ngModel);void 0!==e&&null!==e||!E||""===E||g.$setViewValue(E)}f.displayElements.forminput.val(g.$viewValue),f._elementSelectTriggered||(f.html=g.$viewValue||"")};var D=function(e){return h.required&&g.$setValidity("required",!(!e||""===e.trim())),e};g.$parsers.push(D),g.$formatters.push(D)}else f.displayElements.forminput.val(E),f.html=E;if(f.$watch("html",function(e,t){e!==t&&(h.ngModel&&g.$viewValue!==e&&g.$setViewValue(e),f.displayElements.forminput.val(e))}),h.taTargetToolbars)C=o.registerEditor(f._name,f,h.taTargetToolbars.split(","));else{var A=angular.element('<div text-angular-toolbar name="textAngularToolbar'+N+'">');h.taToolbar&&A.attr("ta-toolbar",h.taToolbar),h.taToolbarClass&&A.attr("ta-toolbar-class",h.taToolbarClass),h.taToolbarGroupClass&&A.attr("ta-toolbar-group-class",h.taToolbarGroupClass),h.taToolbarButtonClass&&A.attr("ta-toolbar-button-class",h.taToolbarButtonClass),h.taToolbarActiveButtonClass&&A.attr("ta-toolbar-active-button-class",h.taToolbarActiveButtonClass),h.taFocussedClass&&A.attr("ta-focussed-class",h.taFocussedClass),p.prepend(A),e(A)(f.$parent),C=o.registerEditor(f._name,f,["textAngularToolbar"+N])}f.$on("$destroy",function(){o.unregisterEditor(f._name)}),f.$on("ta-element-select",function(e,t){C.triggerElementSelect(e,t)&&f["reApplyOnSelectorHandlerstaTextElement"+N]()}),f.$on("ta-drop-event",function(e,n,a,r){f.displayElements.text[0].focus(),r&&r.files&&r.files.length>0?(angular.forEach(r.files,function(e){try{c.when(f.fileDropHandler(e,f.wrapSelection)||f.fileDropHandler!==f.defaultFileDropHandler&&c.when(f.defaultFileDropHandler(e,f.wrapSelection))).then(function(){f["updateTaBindtaTextElement"+N]()})}catch(t){d.error(t)}}),a.preventDefault(),a.stopPropagation()):t(function(){f["updateTaBindtaTextElement"+N]()},0)}),f._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){f._bUpdateSelectedStyles=!1,f.focussed=!1}),f.updateSelectedStyles=function(){var e;void 0!==(e=a.getSelectionElement())&&e.parentNode!==f.displayElements.text[0]?C.updateSelectedStyles(angular.element(e)):C.updateSelectedStyles(),f._bUpdateSelectedStyles&&t(f.updateSelectedStyles,200)},m=function(){return f.focussed?void(f._bUpdateSelectedStyles||(f._bUpdateSelectedStyles=!0,f.$apply(function(){f.updateSelectedStyles()}))):void(f._bUpdateSelectedStyles=!1)},f.displayElements.html.on("keydown",m),f.displayElements.text.on("keydown",m),v=function(){f._bUpdateSelectedStyles=!1},f.displayElements.html.on("keyup",v),f.displayElements.text.on("keyup",v),y=function(e,t){t&&angular.extend(e,t),f.$apply(function(){return C.sendKeyCommand(e)?(f._bUpdateSelectedStyles||f.updateSelectedStyles(),e.preventDefault(),!1):void 0})},f.displayElements.html.on("keypress",y),f.displayElements.text.on("keypress",y),b=function(){f._bUpdateSelectedStyles=!1,f.$apply(function(){f.updateSelectedStyles()})},f.displayElements.html.on("mouseup",b),f.displayElements.text.on("mouseup",b)}}}]),g.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,n){var a={},r={};return{registerEditor:function(n,o,i){if(!n||""===n)throw"textAngular Error: An editor requires a name";if(!o)throw"textAngular Error: An editor requires a scope";if(r[n])throw'textAngular Error: An Editor with name "'+n+'" already exists';var l=[];return angular.forEach(i,function(e){a[e]&&l.push(a[e])}),r[n]={scope:o,toolbars:i,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&l.push(e)},editorFunctions:{disable:function(){angular.forEach(l,function(e){e.disabled=!0})},enable:function(){angular.forEach(l,function(e){e.disabled=!1})},focus:function(){angular.forEach(l,function(e){e._parent=o,e.disabled=!1,e.focussed=!0,o.focussed=!0})},unfocus:function(){angular.forEach(l,function(e){e.disabled=!0,e.focussed=!1}),o.focussed=!1},updateSelectedStyles:function(e){angular.forEach(l,function(t){angular.forEach(t.tools,function(n){n.activeState&&(t._parent=o,n.active=n.activeState(e))})})},sendKeyCommand:function(n){var a=!1;return(n.ctrlKey||n.metaKey)&&angular.forEach(t,function(t,r){if(t.commandKeyCode&&t.commandKeyCode===n.which)for(var i=0;i<l.length;i++)if(void 0!==l[i].tools[r]){e.call(l[i].tools[r],o),a=!0;break}}),a},triggerElementSelect:function(e,n){var a=function(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n},r=[],i={},s=!1;n=angular.element(n);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),(!e.onElementSelect.onlyWithAttrs||a(n,e.onElementSelect.onlyWithAttrs))&&(i[t]=e))}),d?(angular.forEach(i,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(i,function(e,t){r.push({name:t,tool:e})}),r.length>0)for(var c=0;c<r.length;c++){for(var u=r[c].tool,f=r[c].name,p=0;p<l.length;p++)if(void 0!==l[p].tools[f]){u.onElementSelect.action.call(l[p].tools[f],e,n,o),s=!0;break}if(s)break}return s}}},r[n].editorFunctions},retrieveEditor:function(e){return r[e]},unregisterEditor:function(e){delete r[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(a[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';a[e.name]=e,angular.forEach(r,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return a[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete a[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,n){t.updateToolDisplay(n,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,n){e.resetToolDisplay(n)})},updateToolDisplay:function(e,t){var n=this;angular.forEach(a,function(a,r){n.updateToolbarToolDisplay(r,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(a,function(n,a){t.resetToolbarToolDisplay(a,e)})},updateToolbarToolDisplay:function(e,t,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(n,t[n],!0)},removeTool:function(e){delete t[e],angular.forEach(a,function(t){delete t.tools[e];for(var n=0;n<t.toolbar.length;n++){for(var a,r=0;r<t.toolbar[n].length;r++){if(t.toolbar[n][r]===e){a={group:n,index:r};break}if(void 0!==a)break}void 0!==a&&(t.toolbar[a.group].slice(a.index,1),t._$element.children().eq(a.group).children().eq(a.index).remove())}})},addTool:function(e,t,r,o){n(e,t),angular.forEach(a,function(n){n.addTool(e,t,r,o)})},addToolToToolbar:function(e,t,r,o,i){n(e,t),a[r].addTool(e,t,o,i)},refreshEditor:function(e){if(!r[e])throw'textAngular Error: No Editor with name "'+e+'" exists';r[e].scope.updateTaBindtaTextElement(),r[e].scope.$$phase||r[e].scope.$digest()}}}]),g.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,n,a,r,o){return{scope:{name:"@"},restrict:"EA",link:function(i,l,s){if(!i.name||""===i.name)throw"textAngular Error: A toolbar requires a name";angular.extend(i,angular.copy(n)),s.taToolbar&&(i.toolbar=i.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(i.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(i.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(i.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(i.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(i.classes.focussed=s.taFocussedClass),i.disabled=!0,i.focussed=!1,i._$element=l,l[0].innerHTML="",l.addClass("ta-toolbar "+i.classes.toolbar),i.$watch("focussed",function(){i.focussed?l.addClass(i.classes.focussed):l.removeClass(i.classes.focussed)});var d=function(t,n){var a;if(a=angular.element(t&&t.display?t.display:"<button type='button'>"),a.addClass(t&&t["class"]?t["class"]:i.classes.toolbarButton),a.attr("name",n.name),a.attr("unselectable","on"),a.attr("ng-disabled","isDisabled()"),a.attr("tabindex","-1"),a.attr("ng-click","executeAction()"),a.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&a.attr("title",t.tooltiptext),a.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),t&&!t.display&&!n._display&&(a[0].innerHTML="",t.buttontext&&(a[0].innerHTML=t.buttontext),t.iconclass)){var r=angular.element("<i>"),o=a[0].innerHTML;r.addClass(t.iconclass),a[0].innerHTML="",a.append(r),o&&""!==o&&a.append("&nbsp;"+o)}return n._lastToolDefinition=angular.copy(t),e(a)(n)};i.tools={},i._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var c={$window:o,$editor:function(){return i._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?i.classes.toolbarButtonActive:""},executeAction:r};angular.forEach(i.toolbar,function(e){var t=angular.element("<div>");t.addClass(i.classes.toolbarGroup),angular.forEach(e,function(e){i.tools[e]=angular.extend(i.$new(!0),a[e],c,{name:e}),i.tools[e].$element=d(a[e],i.tools[e]),t.append(i.tools[e].$element)}),l.append(t)}),i.updateToolDisplay=function(e,t,n){var a=i.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var r=d(t,a);a.$element.replaceWith(r),a.$element=r}},i.addTool=function(e,t,n,r){i.tools[e]=angular.extend(i.$new(!0),a[e],c,{name:e}),i.tools[e].$element=d(a[e],i.tools[e]);var o;void 0===n&&(n=i.toolbar.length-1),o=angular.element(l.children()[n]),void 0===r?(o.append(i.tools[e].$element),i.toolbar[n][i.toolbar[n].length-1]=e):(o.children().eq(r).after(i.tools[e].$element),i.toolbar[n][r]=e)},t.registerToolbar(i),i.$on("$destroy",function(){t.unregisterToolbar(i.name)})}}}])}()}({},function(){return this}()),!function(e,t){t["true"]=e,function(e,t){"use strict";function n(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return o(t,c(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}function a(e){var n=[],a=c(n,t.noop);return a.chars(e),n.join("")}function r(e){var t,n={},a=e.split(",");for(t=0;t<a.length;t++)n[a[t]]=!0;return n}function o(e,n){function a(e,a,o,l){if(a=t.lowercase(a),N[a])for(;c.last()&&$[c.last()];)r("",c.last());T[a]&&c.last()==a&&r("",a),l=E[a]||!!l,l||c.push(a);var s={};o.replace(h,function(e,t,n,a,r){var o=n||a||r||"";s[t]=i(o)}),n.start&&n.start(a,s,l)}function r(e,a){var r,o=0;if(a=t.lowercase(a))for(o=c.length-1;o>=0&&c[o]!=a;o--);if(o>=0){for(r=c.length-1;r>=o;r--)n.end&&n.end(c[r]);c.length=o}}"string"!=typeof e&&(e=null===e||"undefined"==typeof e?"":""+e);var o,l,s,d,c=[],x=e;for(c.last=function(){return c[c.length-1]};e;){if(d="",l=!0,c.last()&&k[c.last()]?(e=e.replace(new RegExp("([^]*)<\\s*\\/\\s*"+c.last()+"[^>]*>","i"),function(e,t){return t=t.replace(v,"$1").replace(b,"$1"),n.chars&&n.chars(i(t)),""}),r("",c.last())):(0===e.indexOf("<!--")?(o=e.indexOf("--",4),o>=0&&e.lastIndexOf("-->",o)===o&&(n.comment&&n.comment(e.substring(4,o)),e=e.substring(o+3),l=!1)):y.test(e)?(s=e.match(y),s&&(e=e.replace(s[0],""),l=!1)):m.test(e)?(s=e.match(p),s&&(e=e.substring(s[0].length),s[0].replace(p,r),l=!1)):g.test(e)&&(s=e.match(f),s?(s[4]&&(e=e.substring(s[0].length),s[0].replace(f,a)),l=!1):(d+="<",e=e.substring(1))),l&&(o=e.indexOf("<"),d+=0>o?e:e.substring(0,o),e=0>o?"":e.substring(o),n.chars&&n.chars(i(d)))),e==x)throw u("badparse","The sanitizer was unable to parse the following block of html: {0}",e);x=e}r()}function i(e){if(!e)return"";var t=H.exec(e),n=t[1],a=t[3],r=t[2];return r&&(O.innerHTML=r.replace(/</g,"&lt;"),r="textContent"in O?O.textContent:O.innerText),n+r+a}function l(e){return e.replace(/&/g,"&amp;").replace(x,function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(n-56320)+65536)+";"}).replace(w,function(e){var t=e.charCodeAt(0);return 159>=t||173==t||t>=1536&&1540>=t||1807==t||6068==t||6069==t||t>=8204&&8207>=t||t>=8232&&8239>=t||t>=8288&&8303>=t||65279==t||t>=65520&&65535>=t?"&#"+t+";":e}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(e){var n="",a=e.split(";");return t.forEach(a,function(e){var a=e.split(":");if(2==a.length){var r=B(t.lowercase(a[0])),e=B(t.lowercase(a[1]));(("color"===r||"background-color"===r)&&(e.match(/^rgb\([0-9%,\. ]*\)$/i)||e.match(/^rgba\([0-9%,\. ]*\)$/i)||e.match(/^hsl\([0-9%,\. ]*\)$/i)||e.match(/^hsla\([0-9%,\. ]*\)$/i)||e.match(/^#[0-9a-f]{3,6}$/i)||e.match(/^[a-z]*$/i))||"text-align"===r&&("left"===e||"right"===e||"center"===e||"justify"===e)||"float"===r&&("left"===e||"right"===e||"none"===e)||("width"===r||"height"===r)&&e.match(/[0-9\.]*(px|em|rem|%)/)||"direction"===r&&e.match(/^ltr|rtl|initial|inherit$/))&&(n+=r+": "+e+";")}}),n}function d(e,t,n,a){return"img"===e&&t["ta-insert-video"]&&("ta-insert-video"===n||"allowfullscreen"===n||"frameborder"===n||"contenteditable"===n&&"false"===a)?!0:!1}function c(e,n){var a=!1,r=t.bind(e,e.push);return{start:function(e,o,i){e=t.lowercase(e),!a&&k[e]&&(a=e),a||D[e]!==!0||(r("<"),r(e),t.forEach(o,function(a,i){var c=t.lowercase(i),u="img"===e&&"src"===c||"background"===c;("style"===c&&""!==(a=s(a))||d(e,o,c,a)||_[c]===!0&&(A[c]!==!0||n(a,u)))&&(r(" "),r(i),r('="'),r(l(a)),r('"'))}),r(i?"/>":">"))},end:function(e){e=t.lowercase(e),a||D[e]!==!0||(r("</"),r(e),r(">")),e==a&&(a=!1)},chars:function(e){a||r(l(e))}}}var u=t.$$minErr("$sanitize"),f=/^<((?:[a-zA-Z])[\w:-]*)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*(>?)/,p=/^<\/\s*([\w:-]+)[^>]*>/,h=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,g=/^</,m=/^<\//,v=/<!--(.*?)-->/g,y=/<!DOCTYPE([^>]*?)>/i,b=/<!\[CDATA\[(.*?)]]>/g,x=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,w=/([^\#-~| |!])/g,E=r("area,br,col,hr,img,wbr"),C=r("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),S=r("rp,rt"),T=t.extend({},S,C),N=t.extend({},C,r("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),$=t.extend({},S,r("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),R=r("animate,animateColor,animateMotion,animateTransform,circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,radialGradient,rect,set,stop,svg,switch,text,title,tspan,use"),k=r("script,style"),D=t.extend({},E,N,$,T,R),A=r("background,cite,href,longdesc,src,usemap,xlink:href"),L=r("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,id,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width"),M=r("accent-height,accumulate,additive,alphabetic,arabic-form,ascent,attributeName,attributeType,baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan"),_=t.extend({},A,M,L),O=document.createElement("pre"),H=/^(\s*)([\s\S]*?)(\s*)$/,B=function(){return String.prototype.trim?function(e){return t.isString(e)?e.trim():e}:function(e){return t.isString(e)?e.replace(/^\s\s*/,"").replace(/\s\s*$/,""):e}}();t.module("ngSanitize",[]).provider("$sanitize",n),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"”’]/,r=/^mailto:/;return function(o,i){function l(e){e&&p.push(a(e))}function s(e,n){p.push("<a "),t.isDefined(i)&&p.push('target="',i,'" '),p.push('href="',e.replace(/"/g,"&quot;"),'">'),l(n),p.push("</a>")}if(!o)return o;for(var d,c,u,f=o,p=[];d=f.match(n);)c=d[0],d[2]||d[4]||(c=(d[3]?"http://":"mailto:")+c),u=d.index,l(f.substr(0,u)),s(c,d[0].replace(r,"")),f=f.substring(u+d[0].length);return l(f),e(p.join(""))}}])}(window,window.angular)}({},function(){return this}()),!function(e,t){t["true"]=e,angular.module("textAngularSetup",[]).value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","p","pre","quote"],["bold","italics","underline","strikeThrough","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","insertVideo","wordcount","charcount"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},setup:{textEditorSetup:function(){},htmlEditorSetup:function(){}},defaultFileDropHandler:function(e,t){var n=new FileReader;return"image"===e.type.substring(0,5)?(n.onload=function(){""!==n.result&&t("insertImage",n.result,!0)},n.readAsDataURL(e),!0):!1}}).value("taSelectableElements",["a","img"]).value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(e){var t=angular.element("<iframe></iframe>"),n=e.prop("attributes");angular.forEach(n,function(e){t.attr(e.name,e.value)}),t.attr("src",t.attr("ta-insert-video")),e.replaceWith(t)}}]).value("taTranslations",{html:{tooltip:"Toggle html / Rich Text"},heading:{tooltip:"Heading "},p:{tooltip:"Paragraph"},pre:{tooltip:"Preformatted text"},ul:{tooltip:"Unordered List"},ol:{tooltip:"Ordered List"},quote:{tooltip:"Quote/unqoute selection or paragraph"},undo:{tooltip:"Undo"},redo:{tooltip:"Redo"},bold:{tooltip:"Bold"},italic:{tooltip:"Italic"},underline:{tooltip:"Underline"},strikeThrough:{tooltip:"Strikethrough"},justifyLeft:{tooltip:"Align text left"},justifyRight:{tooltip:"Align text right"},justifyCenter:{tooltip:"Center"},indent:{tooltip:"Increase indent"},outdent:{tooltip:"Decrease indent"},clear:{tooltip:"Clear formatting"},insertImage:{dialogPrompt:"Please enter an image URL to insert",tooltip:"Insert image",hotkey:"the - possibly language dependent hotkey ... for some future implementation"},insertVideo:{tooltip:"Insert video",dialogPrompt:"Please enter a youtube URL to embed"},insertLink:{tooltip:"Insert / edit link",dialogPrompt:"Please enter a URL to insert"},editLink:{reLinkButton:{tooltip:"Relink"},unLinkButton:{tooltip:"Unlink"},targetToggle:{buttontext:"Open in New Window"}},wordcount:{tooltip:"Display words Count"},charcount:{tooltip:"Display characters Count"}}).run(["taRegisterTool","$window","taTranslations","taSelection",function(e,t,n,a){e("html",{iconclass:"fa fa-code",tooltiptext:n.html.tooltip,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var r=function(e){return function(){return this.$editor().queryFormatBlockState(e)}},o=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(t){e(t.toLowerCase(),{buttontext:t.toUpperCase(),tooltiptext:n.heading.tooltip+t.charAt(1),action:o,activeState:r(t.toLowerCase())})}),e("p",{buttontext:"P",tooltiptext:n.p.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}}),e("pre",{buttontext:"pre",tooltiptext:n.pre.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}}),e("ul",{iconclass:"fa fa-list-ul",tooltiptext:n.ul.tooltip,action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertUnorderedList")}}),e("ol",{iconclass:"fa fa-list-ol",tooltiptext:n.ol.tooltip,action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return this.$editor().queryCommandState("insertOrderedList")}}),e("quote",{iconclass:"fa fa-quote-right",tooltiptext:n.quote.tooltip,action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("undo",{iconclass:"fa fa-undo",tooltiptext:n.undo.tooltip,action:function(){return this.$editor().wrapSelection("undo",null)}}),e("redo",{iconclass:"fa fa-repeat",tooltiptext:n.redo.tooltip,action:function(){return this.$editor().wrapSelection("redo",null)}}),e("bold",{iconclass:"fa fa-bold",tooltiptext:n.bold.tooltip,action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return this.$editor().queryCommandState("bold")},commandKeyCode:98}),e("justifyLeft",{iconclass:"fa fa-align-left",tooltiptext:n.justifyLeft.tooltip,action:function(){return this.$editor().wrapSelection("justifyLeft",null)
},activeState:function(e){var t=!1;return e&&(t="left"===e.css("text-align")||"left"===e.attr("align")||"right"!==e.css("text-align")&&"center"!==e.css("text-align")&&"justify"!==e.css("text-align")&&!this.$editor().queryCommandState("justifyRight")&&!this.$editor().queryCommandState("justifyCenter")&&!this.$editor().queryCommandState("justifyFull")),t=t||this.$editor().queryCommandState("justifyLeft")}}),e("justifyRight",{iconclass:"fa fa-align-right",tooltiptext:n.justifyRight.tooltip,action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(e){var t=!1;return e&&(t="right"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyRight")}}),e("justifyCenter",{iconclass:"fa fa-align-center",tooltiptext:n.justifyCenter.tooltip,action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(e){var t=!1;return e&&(t="center"===e.css("text-align")),t=t||this.$editor().queryCommandState("justifyCenter")}}),e("indent",{iconclass:"fa fa-indent",tooltiptext:n.indent.tooltip,action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}}),e("outdent",{iconclass:"fa fa-outdent",tooltiptext:n.outdent.tooltip,action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return!1}}),e("italics",{iconclass:"fa fa-italic",tooltiptext:n.italic.tooltip,action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return this.$editor().queryCommandState("italic")},commandKeyCode:105}),e("underline",{iconclass:"fa fa-underline",tooltiptext:n.underline.tooltip,action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return this.$editor().queryCommandState("underline")},commandKeyCode:117}),e("strikeThrough",{iconclass:"fa fa-strikethrough",action:function(){return this.$editor().wrapSelection("strikeThrough",null)},activeState:function(){return document.queryCommandState("strikeThrough")}}),e("clear",{iconclass:"fa fa-ban",tooltiptext:n.clear.tooltip,action:function(e,t){var n;this.$editor().wrapSelection("removeFormat",null);var r=angular.element(a.getSelectionElement()),o=function(e){e=angular.element(e);var t=e;angular.forEach(e.children(),function(e){var n=angular.element("<p></p>");n.html(angular.element(e).html()),t.after(n),t=n}),e.remove()};if(angular.forEach(r.find("ul"),o),angular.forEach(r.find("ol"),o),"li"===r[0].tagName.toLowerCase()){var i=r[0].parentNode.childNodes,l=[],s=[],d=!1;for(n=0;n<i.length;n++)i[n]===r[0]?d=!0:d?s.push(i[n]):l.push(i[n]);var c=angular.element(r[0].parentNode),u=angular.element("<p></p>");if(u.html(angular.element(r[0]).html()),0===l.length||0===s.length)0===s.length?c.after(u):c[0].parentNode.insertBefore(u[0],c[0]),0===l.length&&0===s.length?c.remove():angular.element(r[0]).remove();else{var f=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">"),p=angular.element("<"+c[0].tagName+"></"+c[0].tagName+">");for(n=0;n<l.length;n++)f.append(angular.element(l[n]));for(n=0;n<s.length;n++)p.append(angular.element(s[n]));c.after(p),c.after(u),c.after(f),c.remove()}a.setSelectionToElementEnd(u[0])}var h=this.$editor(),g=function(e){e=angular.element(e),e[0]!==h.displayElements.text[0]&&e.removeAttr("class"),angular.forEach(e.children(),g)};angular.forEach(r,g),"li"!==r[0].tagName.toLowerCase()&&"ol"!==r[0].tagName.toLowerCase()&&"ul"!==r[0].tagName.toLowerCase()&&this.$editor().wrapSelection("formatBlock","default"),t()}});var i=function(e,t,n){var a=function(){n.updateTaBindtaTextElement(),n.hidePopover()};e.preventDefault(),n.displayElements.popover.css("width","375px");var r=n.displayElements.popoverContainer;r.empty();var o=angular.element('<div class="btn-group" style="padding-right: 6px;">'),i=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');i.on("click",function(e){e.preventDefault(),t.css({width:"100%",height:""}),a()});var l=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');l.on("click",function(e){e.preventDefault(),t.css({width:"50%",height:""}),a()});var s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');s.on("click",function(e){e.preventDefault(),t.css({width:"25%",height:""}),a()});var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');d.on("click",function(e){e.preventDefault(),t.css({width:"",height:""}),a()}),o.append(i),o.append(l),o.append(s),o.append(d),r.append(o),o=angular.element('<div class="btn-group" style="padding-right: 6px;">');var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');c.on("click",function(e){e.preventDefault(),t.css("float","left"),t.css("cssFloat","left"),t.css("styleFloat","left"),a()});var u=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');u.on("click",function(e){e.preventDefault(),t.css("float","right"),t.css("cssFloat","right"),t.css("styleFloat","right"),a()});var f=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');f.on("click",function(e){e.preventDefault(),t.css("float",""),t.css("cssFloat",""),t.css("styleFloat",""),a()}),o.append(c),o.append(f),o.append(u),r.append(o),o=angular.element('<div class="btn-group">');var p=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');p.on("click",function(e){e.preventDefault(),t.remove(),a()}),o.append(p),r.append(o),n.showPopover(t),n.showResizeOverlay(t)};e("insertImage",{iconclass:"fa fa-picture-o",tooltiptext:n.insertImage.tooltip,action:function(){var e;return e=t.prompt(n.insertImage.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("insertImage",e,!0):void 0},onElementSelect:{element:"img",action:i}}),e("insertVideo",{iconclass:"fa fa-youtube-play",tooltiptext:n.insertVideo.tooltip,action:function(){var e;if(e=t.prompt(n.insertVideo.dialogPrompt,"https://"),e&&""!==e&&"https://"!==e){var a=e.match(/(\?|&)v=[^&]*/);if(a&&a.length>0){var r="https://www.youtube.com/embed/"+a[0].substring(3),o='<img class="ta-insert-video" src="https://img.youtube.com/vi/'+a[0].substring(3)+'/hqdefault.jpg" ta-insert-video="'+r+'" contenteditable="false" src="" allowfullscreen="true" frameborder="0" />';return this.$editor().wrapSelection("insertHTML",o,!0)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:i}}),e("insertLink",{tooltiptext:n.insertLink.tooltip,iconclass:"fa fa-link",action:function(){var e;return e=t.prompt(n.insertLink.dialogPrompt,"http://"),e&&""!==e&&"http://"!==e?this.$editor().wrapSelection("createLink",e,!0):void 0},activeState:function(e){return e?"A"===e[0].tagName:!1},onElementSelect:{element:"a",action:function(e,a,r){e.preventDefault(),r.displayElements.popover.css("width","435px");var o=r.displayElements.popoverContainer;o.empty(),o.css("line-height","28px");var i=angular.element('<a href="'+a.attr("href")+'" target="_blank">'+a.attr("href")+"</a>");i.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"}),o.append(i);var l=angular.element('<div class="btn-group pull-right">'),s=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+n.editLink.reLinkButton.tooltip+'"><i class="fa fa-edit icon-edit"></i></button>');s.on("click",function(e){e.preventDefault();var o=t.prompt(n.insertLink.dialogPrompt,a.attr("href"));o&&""!==o&&"http://"!==o&&(a.attr("href",o),r.updateTaBindtaTextElement()),r.hidePopover()}),l.append(s);var d=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on" title="'+n.editLink.unLinkButton.tooltip+'"><i class="fa fa-unlink icon-unlink"></i></button>');d.on("click",function(e){e.preventDefault(),a.replaceWith(a.contents()),r.updateTaBindtaTextElement(),r.hidePopover()}),l.append(d);var c=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on">'+n.editLink.targetToggle.buttontext+"</button>");"_blank"===a.attr("target")&&c.addClass("active"),c.on("click",function(e){e.preventDefault(),a.attr("target","_blank"===a.attr("target")?"":"_blank"),c.toggleClass("active"),r.updateTaBindtaTextElement()}),l.append(c),o.append(l),r.showPopover(a)}}}),e("wordcount",{display:'<div id="toolbarWC" style="display:block; min-width:100px;">Words:{{wordcount}}</div>',disabled:!0,wordcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerHTML,n=t.replace(/(<[^>]*?>)/gi," "),a=n.match(/\S+/g),r=a&&a.length||0;return this.wordcount=r,this.$editor().wordcount=r,!1}}),e("charcount",{display:'<div id="toolbarCC" style="display:block; min-width:120px;">Characters:{{charcount}}</div>',disabled:!0,charcount:0,activeState:function(){var e=this.$editor().displayElements.text,t=e[0].innerText||e[0].textContent,n=t.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+/g," ").replace(/\s+$/g," ").length;return this.charcount=n,this.$editor().charcount=n,!1}})}]),function(){"Use Strict";function e(e){try{return 0!==angular.element(e).length}catch(t){return!1}}function t(t,n){if(!t||""===t||m.hasOwnProperty(t))throw"textAngular Error: A unique name is required for a Tool Definition";if(n.display&&(""===n.display||!e(n.display))||!n.display&&!n.buttontext&&!n.iconclass)throw'textAngular Error: Tool Definition for "'+t+'" does not have a valid display/iconclass/buttontext value';m[t]=n}var n={ie:function(){for(var e,t=3,n=document.createElement("div"),a=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",a[0];);return t>4?t:e}(),webkit:/AppleWebKit\/([\d.]+)/i.test(navigator.userAgent)},a=!1;n.webkit&&(document.addEventListener("mousedown",function(e){var t=e||window.event,n=t.target;if(a&&null!==n){for(var r=!1,o=n;null!==o&&"html"!==o.tagName.toLowerCase()&&!r;)r="true"===o.contentEditable,o=o.parentNode;r||(document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0),n.focus(),n.select&&n.select())}a=!1},!1),angular.element(document).ready(function(){angular.element(document.body).append(angular.element('<input id="textAngular-editableFix-010203040506070809" class="ta-hidden-input" unselectable="on" tabIndex="-1">'))}));var r=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)$/i,o=/^(ul|li|ol)$/i,i=/^(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video|li)$/i;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var l,s,d,c,u;if(n.ie>8||void 0===n.ie){for(var f=document.styleSheets,p=0;p<f.length;p++)if((0===f[p].media.length||f[p].media.mediaText.match(/(all|screen)/gi))&&f[p].href&&f[p].href.match(/textangular\.(min\.|)css/gi)){l=f[p];break}l||(l=function(){var e=document.createElement("style");return n.webkit&&e.appendChild(document.createTextNode("")),document.getElementsByTagName("head")[0].appendChild(e),e.sheet}()),s=function(e,t){return c(l,e,t)},c=function(e,t,n){var a;return e.cssRules?a=Math.max(e.cssRules.length-1,0):e.rules&&(a=Math.max(e.rules.length-1,0)),e.insertRule?e.insertRule(t+"{"+n+"}",a):e.addRule(t,n,a),a},d=function(e){u(l,e)},u=function(e,t){e.removeRule?e.removeRule(t):e.deleteRule(t)}}angular.module("textAngular.factories",[]).factory("taBrowserTag",[function(){return function(e){return e?""===e?void 0===n.ie?"div":n.ie<=8?"P":"p":n.ie<=8?e.toUpperCase():e:n.ie<=8?"P":"p"}}]).factory("taApplyCustomRenderers",["taCustomRenderers","taDOM",function(e,t){return function(n){var a=angular.element("<div></div>");return a[0].innerHTML=n,angular.forEach(e,function(e){var n=[];e.selector&&""!==e.selector?n=a.find(e.selector):e.customAttribute&&""!==e.customAttribute&&(n=t.getByAttribute(a,e.customAttribute)),angular.forEach(n,function(t){t=angular.element(t),e.selector&&""!==e.selector&&e.customAttribute&&""!==e.customAttribute?void 0!==t.attr(e.customAttribute)&&e.renderLogic(t):e.renderLogic(t)})}),a[0].innerHTML}}]).factory("taFixChrome",function(){var e=function(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n,a,r=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,o="",i=0;t=r.exec(e);)n=t[3]||t[4],n&&n.match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)&&(n=n.replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,""),a="<"+t[1].trim(),n.length>0&&(a+=" style="+t[2].substring(0,1)+n+t[2].substring(0,1)),a+=t[5].trim()+">",o+=e.substring(i,t.index)+a,i=t.index+t[0].length);return o+=e.substring(i),i>0?o.replace(/<span\s*>(.*?)<\/span>(<br(\/|)>|)/gi,"$1"):e};return e}).factory("taSanitize",["$sanitize","taDOM",function(e){function t(e,t){for(var n,a=0,r=0,o=/<[^>]*>/gi;n=o.exec(e);)if(r=n.index,"/"===n[0].substr(1,1)){if(0===a)break;a--}else a++;return t+e.substring(0,r)+angular.element(t)[0].outerHTML.substring(t.length)+e.substring(r)}function n(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var a,o,i,l,d,c=/<([^>\/]+?)style=("([^"]+)"|'([^']+)')([^>]*)>/gi,u="",f="",p=0;o=c.exec(e);){i=o[3]||o[4];var h=new RegExp(s,"i");if(angular.isString(i)&&h.test(i)){l="";for(var g=new RegExp(s,"ig");subMatch=g.exec(i);)for(a=0;a<r.length;a++)subMatch[2*a+2]&&(l+="<"+r[a].tag+">");d=n(e.substring(p,o.index)),f+=u.length>0?t(d,u):d,i=i.replace(new RegExp(s,"ig"),""),f+="<"+o[1].trim(),i.length>0&&(f+=' style="'+i+'"'),f+=o[5]+">",p=o.index+o[0].length,u=l}}return f+=u.length>0?t(e.substring(p),u):e.substring(p)}function a(e){if(!e||!angular.isString(e)||e.length<=0)return e;for(var t,n=/<([^>\/]+?)align=("([^"]+)"|'([^']+)')([^>]*)>/gi,a="",r=0;t=n.exec(e);)a+=e.substring(r,t.index),r=t.index+t[0].length,newTag="<"+t[1]+t[5],/style=("([^"]+)"|'([^']+)')/gi.test(newTag)?newTag=newTag.replace(/style=("([^"]+)"|'([^']+)')/i,'style="$2$3 text-align:'+(t[3]||t[4])+';"'):newTag+=' style="text-align:'+(t[3]||t[4])+';"',newTag+=">",a+=newTag;return a+e.substring(r)}for(var r=[{property:"font-weight",values:["bold"],tag:"b"},{property:"font-style",values:["italic"],tag:"i"}],o=[],i=0;i<r.length;i++){var l="("+r[i].property+":\\s*(";for(j=0;j<r[i].values.length;j++)j>0&&(l+="|"),l+=r[i].values[j];l+=");)",o.push(l)}var s="("+o.join("|")+")";return function(t,r,o){if(!o)try{t=n(t)}catch(i){}t=a(t);var l;try{l=e(t),o&&(l=t)}catch(i){l=r||""}var s=l.match(/(<pre[^>]*>.*?<\/pre[^>]*>)/gi);processedSafe=l.replace(/(&#(9|10);)*/gi,"");var d,c=/<pre[^>]*>.*?<\/pre[^>]*>/gi,u=0,f=0;for(l="";null!==(d=c.exec(processedSafe))&&u<s.length;)l+=processedSafe.substring(f,d.index)+s[u],f=d.index+d[0].length,u++;return l+processedSafe.substring(f)}}]).factory("taToolExecuteAction",["$q","$log",function(e,t){return function(n){void 0!==n&&(this.$editor=function(){return n});var a=e.defer(),r=a.promise,o=this.$editor();r["finally"](function(){o.endAction.call(o)});var i;try{i=this.action(a,o.startAction())}catch(l){t.error(l)}(i||void 0===i)&&a.resolve()}}]),angular.module("textAngular.DOM",["textAngular.factories"]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(e,t,n){var a=function(t,n){var a,r,o=t.find("li");for(r=o.length-1;r>=0;r--)a=angular.element("<"+n+">"+o[r].innerHTML+"</"+n+">"),t.after(a);t.remove(),e.setSelectionToElementEnd(a[0])},i=function(t){/(<br(|\/)>)$/i.test(t.innerHTML.trim())?e.setSelectionBeforeElement(angular.element(t).find("br")[0]):e.setSelectionToElementEnd(t)},l=function(e,t){var n=angular.element("<"+t+">"+e[0].innerHTML+"</"+t+">");e.after(n),e.remove(),i(n.find("li")[0])},s=function(e,n,a){for(var r="",o=0;o<e.length;o++)r+="<"+t("li")+">"+e[o].innerHTML+"</"+t("li")+">";var l=angular.element("<"+a+">"+r+"</"+a+">");n.after(l),n.remove(),i(l.find("li")[0])};return function(i,d){return i=t(i),function(c,u,f){var p,h,g,m,v,y,b,x=angular.element("<"+i+">");try{b=e.getSelectionElement()}catch(w){}var E=angular.element(b);if(void 0!==b){var C=b.tagName.toLowerCase();if("insertorderedlist"===c.toLowerCase()||"insertunorderedlist"===c.toLowerCase()){var S=t("insertorderedlist"===c.toLowerCase()?"ol":"ul");if(C===S)return a(E,i);if("li"===C&&E.parent()[0].tagName.toLowerCase()===S&&1===E.parent().children().length)return a(E.parent(),i);if("li"===C&&E.parent()[0].tagName.toLowerCase()!==S&&1===E.parent().children().length)return l(E.parent(),S);if(C.match(r)&&!E.hasClass("ta-bind")){if("ol"===C||"ul"===C)return l(E,S);var T=!1;return angular.forEach(E.children(),function(e){e.tagName.match(r)&&(T=!0)}),T?s(E.children(),E,S):s([angular.element("<div>"+b.innerHTML+"</div>")[0]],E,S)}if(C.match(r)){if(m=e.getOnlySelectedElements(),0===m.length)h=angular.element("<"+S+"><li>"+b.innerHTML+"</li></"+S+">"),E.html(""),E.append(h);else{if(1===m.length&&("ol"===m[0].tagName.toLowerCase()||"ul"===m[0].tagName.toLowerCase()))return m[0].tagName.toLowerCase()===S?a(angular.element(m[0]),i):l(angular.element(m[0]),S);g="";var N=[];for(p=0;p<m.length;p++)if(3!==m[p].nodeType){var $=angular.element(m[p]);if("li"===m[p].tagName.toLowerCase())continue;g+="ol"===m[p].tagName.toLowerCase()||"ul"===m[p].tagName.toLowerCase()?$[0].innerHTML:"span"!==m[p].tagName.toLowerCase()||"ol"!==m[p].childNodes[0].tagName.toLowerCase()&&"ul"!==m[p].childNodes[0].tagName.toLowerCase()?"<"+t("li")+">"+$[0].innerHTML+"</"+t("li")+">":$[0].childNodes[0].innerHTML,N.unshift($)}h=angular.element("<"+S+">"+g+"</"+S+">"),N.pop().replaceWith(h),angular.forEach(N,function(e){e.remove()})}return void e.setSelectionToElementEnd(h[0])}}else{if("formatblock"===c.toLowerCase()){for(y=f.toLowerCase().replace(/[<>]/gi,""),"default"===y.trim()&&(y=i,f="<"+i+">"),h="li"===C?E.parent():E;!h[0].tagName||!h[0].tagName.match(r)&&!h.parent().attr("contenteditable");)h=h.parent(),C=(h[0].tagName||"").toLowerCase();if(C===y){m=h.children();var R=!1;for(p=0;p<m.length;p++)R=R||m[p].tagName.match(r);R?(h.after(m),v=h.next(),h.remove(),h=v):(x.append(h[0].childNodes),h.after(x),h.remove(),h=x)}else if(h.parent()[0].tagName.toLowerCase()!==y||h.parent().hasClass("ta-bind"))if(C.match(o))h.wrap(f);else{for(m=e.getOnlySelectedElements(),0===m.length&&(m=[h[0]]),p=0;p<m.length;p++)if(3===m[p].nodeType||!m[p].tagName.match(r))for(;3===m[p].nodeType||!m[p].tagName||!m[p].tagName.match(r);)m[p]=m[p].parentNode;if(angular.element(m[0]).hasClass("ta-bind"))h=angular.element(f),h[0].innerHTML=m[0].innerHTML,m[0].innerHTML=h[0].outerHTML;else if("blockquote"===y){for(g="",p=0;p<m.length;p++)g+=m[p].outerHTML;for(h=angular.element(f),h[0].innerHTML=g,m[0].parentNode.insertBefore(h[0],m[0]),p=m.length-1;p>=0;p--)m[p].parentNode&&m[p].parentNode.removeChild(m[p])}else for(p=0;p<m.length;p++)h=angular.element(f),h[0].innerHTML=m[p].innerHTML,m[p].parentNode.insertBefore(h[0],m[p]),m[p].parentNode.removeChild(m[p])}else{var k=h.parent(),D=k.contents();for(p=0;p<D.length;p++)k.parent().hasClass("ta-bind")&&3===D[p].nodeType&&(x=angular.element("<"+i+">"),x[0].innerHTML=D[p].outerHTML,D[p]=x[0]),k.parent()[0].insertBefore(D[p],k[0]);k.remove()}return void e.setSelectionToElementEnd(h[0])}if("createlink"===c.toLowerCase()){var A=e.getSelection();if(A.collapsed)return void e.insertHtml('<a href="'+f+'">'+f+"</a>",d)}else if("inserthtml"===c.toLowerCase())return void e.insertHtml(f,d)}}try{n[0].execCommand(c,u,f)}catch(w){}}}}]).service("taSelection",["$window","$document","taDOM",function(e,t,n){var a=t[0],o=e.rangy,l=function(e,t){return e.tagName&&e.tagName.match(/^br$/i)&&0===t&&!e.previousSibling?{element:e.parentNode,offset:0}:{element:e,offset:t}},s={getSelection:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer,n={start:l(e.startContainer,e.startOffset),end:l(e.endContainer,e.endOffset),collapsed:e.collapsed};return t=3===t.nodeType?t.parentNode:t,n.container=t.parentNode===n.start.element||t.parentNode===n.end.element?t.parentNode:t,n},getOnlySelectedElements:function(){var e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer;return t=3===t.nodeType?t.parentNode:t,e.getNodes([1],function(e){return e.parentNode===t})},getSelectionElement:function(){return s.getSelection().container},setSelection:function(e,t,n){var a=o.createRange();a.setStart(e,t),a.setEnd(e,n),o.getSelection().setSingleRange(a)},setSelectionBeforeElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionAfterElement:function(e){var t=o.createRange();t.selectNode(e),t.collapse(!1),o.getSelection().setSingleRange(t)},setSelectionToElementStart:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!0),o.getSelection().setSingleRange(t)},setSelectionToElementEnd:function(e){var t=o.createRange();t.selectNodeContents(e),t.collapse(!1),e.childNodes&&e.childNodes[e.childNodes.length-1]&&"br"===e.childNodes[e.childNodes.length-1].nodeName&&(t.startOffset=t.endOffset=t.startOffset-1),o.getSelection().setSingleRange(t)},insertHtml:function(e,t){var l,d,c,u,f,p,h,g=angular.element("<div>"+e+"</div>"),m=o.getSelection().getRangeAt(0),v=a.createDocumentFragment(),y=g[0].childNodes,b=!0;if(y.length>0){for(u=[],c=0;c<y.length;c++)"p"===y[c].nodeName.toLowerCase()&&""===y[c].innerHTML.trim()||3===y[c].nodeType&&""===y[c].nodeValue.trim()||(b=b&&!r.test(y[c].nodeName),u.push(y[c]));for(var x=0;x<u.length;x++)p=v.appendChild(u[x]);!b&&m.collapsed&&/^(|<br(|\/)>)$/i.test(m.startContainer.innerHTML)&&m.selectNode(m.startContainer)}else b=!0,p=v=a.createTextNode(e);if(b)m.deleteContents();else if(m.collapsed&&m.startContainer!==t)if(m.startContainer.innerHTML&&m.startContainer.innerHTML.match(/^<[^>]*>$/i))l=m.startContainer,1===m.startOffset?(m.setStartAfter(l),m.setEndAfter(l)):(m.setStartBefore(l),m.setEndBefore(l));else{if(3===m.startContainer.nodeType&&m.startContainer.parentNode!==t)for(l=m.startContainer.parentNode,d=l.cloneNode(),n.splitNodes(l.childNodes,l,d,m.startContainer,m.startOffset);!i.test(l.nodeName);){angular.element(l).after(d),l=l.parentNode;var w=d;d=l.cloneNode(),n.splitNodes(l.childNodes,l,d,w)}else l=m.startContainer,d=l.cloneNode(),n.splitNodes(l.childNodes,l,d,void 0,void 0,m.startOffset);if(angular.element(l).after(d),m.setStartAfter(l),m.setEndAfter(l),/^(|<br(|\/)>)$/i.test(l.innerHTML.trim())&&(m.setStartBefore(l),m.setEndBefore(l),angular.element(l).remove()),/^(|<br(|\/)>)$/i.test(d.innerHTML.trim())&&angular.element(d).remove(),"li"===l.nodeName.toLowerCase()){for(h=a.createDocumentFragment(),f=0;f<v.childNodes.length;f++)g=angular.element("<li>"),n.transferChildNodes(v.childNodes[f],g[0]),n.transferNodeAttributes(v.childNodes[f],g[0]),h.appendChild(g[0]);v=h,p&&(p=v.childNodes[v.childNodes.length-1],p=p.childNodes[p.childNodes.length-1])}}else m.deleteContents();m.insertNode(v),p&&s.setSelectionToElementEnd(p)}};return s}]).service("taDOM",function(){var e={getByAttribute:function(t,n){var a=[],r=t.children();return r.length&&angular.forEach(r,function(t){a=a.concat(e.getByAttribute(angular.element(t),n))}),void 0!==t.attr(n)&&a.push(t),a},transferChildNodes:function(e,t){for(t.innerHTML="";e.childNodes.length>0;)t.appendChild(e.childNodes[0]);return t},splitNodes:function(t,n,a,r,o,i){if(!r&&isNaN(i))throw new Error("taDOM.splitNodes requires a splitNode or splitIndex");for(var l=document.createDocumentFragment(),s=document.createDocumentFragment(),d=0;t.length>0&&(isNaN(i)||i!==d)&&t[0]!==r;)l.appendChild(t[0]),d++;for(!isNaN(o)&&o>=0&&t[0]&&(l.appendChild(document.createTextNode(t[0].nodeValue.substring(0,o))),t[0].nodeValue=t[0].nodeValue.substring(o));t.length>0;)s.appendChild(t[0]);e.transferChildNodes(l,n),e.transferChildNodes(s,a)},transferNodeAttributes:function(e,t){for(var n=0;n<e.attributes.length;n++)t.setAttribute(e.attributes[n].name,e.attributes[n].value);return t}};return e}),angular.module("textAngular.validators",[]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){function r(e){var t=angular.element("<div/>");t.html(e);var n=t.text().length;return o>=n?(a.$setValidity("taMaxText",!0),e):void a.$setValidity("taMaxText",!1)}var o=parseInt(e.$eval(n.taMaxText));if(isNaN(o))throw"Max text must be an integer";n.$observe("taMaxText",function(e){if(o=parseInt(e),isNaN(o))throw"Max text must be an integer";a.$dirty&&a.$setViewValue(a.$viewValue)}),a.$parsers.unshift(r)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){function r(e){var t=angular.element("<div/>");t.html(e);var n=t.text().length;return!n||n>=o?(a.$setValidity("taMinText",!0),e):void a.$setValidity("taMinText",!1)}var o=parseInt(e.$eval(n.taMinText));if(isNaN(o))throw"Min text must be an integer";n.$observe("taMinText",function(e){if(o=parseInt(e),isNaN(o))throw"Min text must be an integer";a.$dirty&&a.$setViewValue(a.$viewValue)}),a.$parsers.unshift(r)}}}),angular.module("textAngular.taBind",["textAngular.factories","textAngular.DOM"]).service("_taBlankTest",[function(){var e=/<(a|abbr|acronym|bdi|bdo|big|cite|code|del|dfn|img|ins|kbd|label|map|mark|q|ruby|rp|rt|s|samp|time|tt|var)[^>]*(>|$)/i;return function(t){return function(n){if(!n)return!0;var a,r=/(^[^<]|>)[^<]/i.exec(n);return r?a=r.index:(n=n.toString().replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,"").replace(/="[^"]*"/i,""),a=n.indexOf(">")),n=n.trim().substring(a,a+100),/^[^<>]+$/i.test(n)?!1:0===n.length||n===t||/^>(\s|&nbsp;)*<\/[^>]+>$/gi.test(n)?!0:/>\s*[^\s<]/i.test(n)||e.test(n)?!1:!0}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers","taOptions","_taBlankTest","$parse","taDOM",function(e,t,r,o,l,c,u,f,p,g,m,v,y){return{require:"ngModel",link:function(c,b,x,w){var E,C,S,T,N=void 0!==b.attr("contenteditable")&&b.attr("contenteditable"),$=N||"textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase(),R=!1,k=!1,D=!1,A=x.taUnsafeSanitizer||g.disableSanitizer,L=/^(9|19|20|27|33|34|35|36|37|38|39|40|45|112|113|114|115|116|117|118|119|120|121|122|123|144|145)$/i,M=/^(8|13|32|46|59|61|107|109|186|187|188|189|190|191|192|219|220|221|222)$/i;void 0===x.taDefaultWrap&&(x.taDefaultWrap="p"),""===x.taDefaultWrap?(S="",T=void 0===n.ie?"<div><br></div>":n.ie>=11?"<p><br></p>":n.ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"):(S=void 0===n.ie||n.ie>=11?"<"+x.taDefaultWrap+"><br></"+x.taDefaultWrap+">":n.ie<=8?"<"+x.taDefaultWrap.toUpperCase()+"></"+x.taDefaultWrap.toUpperCase()+">":"<"+x.taDefaultWrap+"></"+x.taDefaultWrap+">",T=void 0===n.ie||n.ie>=11?"<"+x.taDefaultWrap+"><br></"+x.taDefaultWrap+">":n.ie<=8?"<"+x.taDefaultWrap.toUpperCase()+">&nbsp;</"+x.taDefaultWrap.toUpperCase()+">":"<"+x.taDefaultWrap+">&nbsp;</"+x.taDefaultWrap+">");var _=m(T);x.taPaste&&(C=v(x.taPaste)),b.addClass("ta-bind");var O;c["$undoManager"+(x.id||"")]=w.$undoManager={_stack:[],_index:0,_max:1e3,push:function(e){return"undefined"==typeof e||null===e||"undefined"!=typeof this.current()&&null!==this.current()&&e===this.current()?e:(this._index<this._stack.length-1&&(this._stack=this._stack.slice(0,this._index+1)),this._stack.push(e),O&&t.cancel(O),this._stack.length>this._max&&this._stack.shift(),this._index=this._stack.length-1,e)},undo:function(){return this.setToIndex(this._index-1)},redo:function(){return this.setToIndex(this._index+1)},setToIndex:function(e){return 0>e||e>this._stack.length-1?void 0:(this._index=e,this.current())},current:function(){return this._stack[this._index]}};var H=c["$undoTaBind"+(x.id||"")]=function(){if(!R&&N){var e=w.$undoManager.undo();"undefined"!=typeof e&&null!==e&&(Q(e),P(e,!1),u.setSelectionToElementEnd(b[0].childNodes.length?b[0].childNodes[b[0].childNodes.length-1]:b[0]))}},B=c["$redoTaBind"+(x.id||"")]=function(){if(!R&&N){var e=w.$undoManager.redo();"undefined"!=typeof e&&null!==e&&(Q(e),P(e,!1),u.setSelectionToElementEnd(b[0].childNodes.length?b[0].childNodes[b[0].childNodes.length-1]:b[0]))}},I=function(){if(N)return b[0].innerHTML;if($)return b.val();throw"textAngular Error: attempting to update non-editable taBind"},P=function(e,t){D=!0,("undefined"==typeof t||null===t)&&(t=!0&&N),("undefined"==typeof e||null===e)&&(e=I()),_(e)?(""!==w.$viewValue&&w.$setViewValue(""),t&&""!==w.$undoManager.current()&&w.$undoManager.push("")):(Y(),w.$viewValue!==e&&(w.$setViewValue(e),t&&w.$undoManager.push(e)))};if(c["updateTaBind"+(x.id||"")]=function(){R||P()},$)if(c.events={},N){var q=!1,W=function(n){if(n&&n.trim().length){if(n.match(/class=["']*Mso(Normal|List)/i)){var a=n.match(/<!--StartFragment-->([\s\S]*?)<!--EndFragment-->/i);a=a?a[1]:n,a=a.replace(/<o:p>[\s\S]*?<\/o:p>/gi,"").replace(/class=(["']|)MsoNormal(["']|)/gi,"");var r=angular.element("<div>"+a+"</div>"),o=angular.element("<div></div>"),i={element:null,lastIndent:[],lastLi:null,isUl:!1};i.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0};for(var l=function(e){i.isUl=e,i.element=angular.element(e?"<ul>":"<ol>"),i.lastIndent=[],i.lastIndent.peek=function(){var e=this.length;return e>0?this[e-1]:void 0},i.lastLevelMatch=null},s=0;s<=r[0].childNodes.length;s++)if(r[0].childNodes[s]&&"#text"!==r[0].childNodes[s].nodeName&&"p"===r[0].childNodes[s].tagName.toLowerCase()){var d=angular.element(r[0].childNodes[s]),f=(d.attr("class")||"").match(/MsoList(Bullet|Number|Paragraph)(CxSp(First|Middle|Last)|)/i);if(f){if(d[0].childNodes.length<2||d[0].childNodes[1].childNodes.length<1)continue;var p="bullet"===f[1].toLowerCase()||"number"!==f[1].toLowerCase()&&!(/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].innerHTML)||/^[^0-9a-z<]*[0-9a-z]+[^0-9a-z<>]</i.test(d[0].childNodes[1].childNodes[0].innerHTML)),h=(d.attr("style")||"").match(/margin-left:([\-\.0-9]*)/i),g=parseFloat(h?h[1]:0),m=(d.attr("style")||"").match(/mso-list:l([0-9]+) level([0-9]+) lfo[0-9+]($|;)/i);if(m&&m[2]&&(g=parseInt(m[2])),m&&(!i.lastLevelMatch||m[1]!==i.lastLevelMatch[1])||!f[3]||"first"===f[3].toLowerCase()||null===i.lastIndent.peek()||i.isUl!==p&&i.lastIndent.peek()===g)l(p),o.append(i.element);else if(null!=i.lastIndent.peek()&&i.lastIndent.peek()<g)i.element=angular.element(p?"<ul>":"<ol>"),i.lastLi.append(i.element);else if(null!=i.lastIndent.peek()&&i.lastIndent.peek()>g){for(;null!=i.lastIndent.peek()&&i.lastIndent.peek()>g;)if("li"!==i.element.parent()[0].tagName.toLowerCase()){if(!/[uo]l/i.test(i.element.parent()[0].tagName.toLowerCase()))break;i.element=i.element.parent(),i.lastIndent.pop()}else i.element=i.element.parent();i.isUl="ul"===i.element[0].tagName.toLowerCase(),p!==i.isUl&&(l(p),o.append(i.element))}i.lastLevelMatch=m,g!==i.lastIndent.peek()&&i.lastIndent.push(g),i.lastLi=angular.element("<li>"),i.element.append(i.lastLi),i.lastLi.html(d.html().replace(/<!(--|)\[if !supportLists\](--|)>[\s\S]*?<!(--|)\[endif\](--|)>/gi,"")),d.remove()}else l(!1),o.append(d)}var v=function(e){e=angular.element(e);for(var t=e[0].childNodes.length-1;t>=0;t--)e.after(e[0].childNodes[t]);e.remove()};angular.forEach(o.find("span"),function(e){e.removeAttribute("lang"),e.attributes.length<=0&&v(e)}),angular.forEach(o.find("font"),v),n=o.html()}else{if(n=n.replace(/<(|\/)meta[^>]*?>/gi,""),n.match(/<[^>]*?(ta-bind)[^>]*?>/)){if(n.match(/<[^>]*?(text-angular)[^>]*?>/)){var x=angular.element("<div>"+n+"</div>");
x.find("textarea").remove();for(var E=y.getByAttribute(x,"ta-bind"),S=0;S<E.length;S++){for(var T=E[S][0].parentNode.parentNode,N=0;N<E[S][0].childNodes.length;N++)T.parentNode.insertBefore(E[S][0].childNodes[N],T);T.parentNode.removeChild(T)}n=x.html().replace('<br class="Apple-interchange-newline">',"")}}else n.match(/^<span/)&&(n=n.replace(/<(|\/)span[^>]*?>/gi,""));n=n.replace(/<br class="Apple-interchange-newline"[^>]*?>/gi,"").replace(/<span class="Apple-converted-space">( |&nbsp;)<\/span>/gi,"&nbsp;")}n=e(n,"",A),C&&(n=C(c,{$html:n})||n),u.insertHtml(n,b[0]),t(function(){w.$setViewValue(I()),q=!1,b.removeClass("processing-paste")},0)}else q=!1,b.removeClass("processing-paste")};if(b.on("paste",c.events.paste=function(e,n){if(n&&angular.extend(e,n),R||q)return e.stopPropagation(),e.preventDefault(),!1;q=!0,b.addClass("processing-paste");var a,i=(e.originalEvent||e).clipboardData;if(i&&i.getData){for(var l="",s=0;s<i.types.length;s++)l+=" "+i.types[s];return/text\/html/i.test(l)?a=i.getData("text/html"):/text\/plain/i.test(l)&&(a=i.getData("text/plain")),W(a),e.stopPropagation(),e.preventDefault(),!1}var d=r.rangy.saveSelection(),c=angular.element('<div class="ta-hidden-input" contenteditable="true"></div>');o.find("body").append(c),c[0].focus(),t(function(){r.rangy.restoreSelection(d),W(c[0].innerHTML),c.remove(),b[0].focus()},0)}),b.on("cut",c.events.cut=function(e){R?e.preventDefault():t(function(){w.$setViewValue(I())},0)}),b.on("keydown",c.events.keydown=function(e,t){if(t&&angular.extend(e,t),!R)if(!e.altKey&&e.metaKey||e.ctrlKey)90!==e.keyCode||e.shiftKey?(90===e.keyCode&&e.shiftKey||89===e.keyCode&&!e.shiftKey)&&(B(),e.preventDefault()):(H(),e.preventDefault());else if(13===e.keyCode&&!e.shiftKey){var n=u.getSelectionElement();if(!n.tagName.match(i))return;var a=angular.element(S);if(/^<br(|\/)>$/i.test(n.innerHTML.trim())&&"blockquote"===n.parentNode.tagName.toLowerCase()&&!n.nextSibling){$selection=angular.element(n);var r=$selection.parent();r.after(a),$selection.remove(),0===r.children().length&&r.remove(),u.setSelectionToElementStart(a[0]),e.preventDefault()}else/^<[^>]+><br(|\/)><\/[^>]+>$/i.test(n.innerHTML.trim())&&"blockquote"===n.tagName.toLowerCase()&&($selection=angular.element(n),$selection.after(a),$selection.remove(),u.setSelectionToElementStart(a[0]),e.preventDefault())}}),b.on("keyup",c.events.keyup=function(e,n){if(n&&angular.extend(e,n),O&&t.cancel(O),!R&&!L.test(e.keyCode)){if(""!==S&&13===e.keyCode&&!e.shiftKey){for(var a=u.getSelectionElement();!a.tagName.match(i)&&a!==b[0];)a=a.parentNode;if(a.tagName.toLowerCase()!==x.taDefaultWrap&&"li"!==a.tagName.toLowerCase()&&(""===a.innerHTML.trim()||"<br>"===a.innerHTML.trim())){var o=angular.element(S);angular.element(a).replaceWith(o),u.setSelectionToElementStart(o[0])}}var l=I();if(""!==S&&""===l.trim())Q(S),u.setSelectionToElementStart(b.children()[0]);else if("<"!==l.substring(0,1)&&""!==x.taDefaultWrap){var s=r.rangy.saveSelection();l=I(),l="<"+x.taDefaultWrap+">"+l+"</"+x.taDefaultWrap+">",Q(l),r.rangy.restoreSelection(s)}var d=E!==e.keyCode&&M.test(e.keyCode);P(l,d),d||(O=t(function(){w.$undoManager.push(l)},250)),E=e.keyCode}}),b.on("blur",c.events.blur=function(){k=!1,R||P(),D=!0,w.$render()}),x.placeholder&&(n.ie>8||void 0===n.ie)){var z;if(!x.id)throw"textAngular Error: An unique ID is required for placeholders to work";z=s("#"+x.id+".placeholder-text:before",'content: "'+x.placeholder+'"'),c.$on("$destroy",function(){d(z)})}b.on("focus",c.events.focus=function(){k=!0,b.removeClass("placeholder-text")}),b.on("mouseup",c.events.mouseup=function(){var e=u.getSelection();e.start.element===b[0]&&b.children().length&&u.setSelectionToElementStart(b.children()[0])}),b.on("mousedown",c.events.mousedown=function(e,t){t&&angular.extend(e,t),e.stopPropagation()})}else{b.on("change blur",c.events.change=c.events.blur=function(){R||w.$setViewValue(I())}),b.on("keydown",c.events.keydown=function(e,t){if(t&&angular.extend(e,t),9===e.keyCode){var n=this.selectionStart,a=this.selectionEnd,r=b.val();if(e.shiftKey){var o=r.lastIndexOf("\n",n),i=r.lastIndexOf("	",n);-1!==i&&i>=o&&(b.val(r.substring(0,i)+r.substring(i+1)),this.selectionStart=this.selectionEnd=n-1)}else b.val(r.substring(0,n)+"	"+r.substring(a)),this.selectionStart=this.selectionEnd=n+1;e.preventDefault()}});var F=function(e,t){for(var n="",a=0;t>a;a++)n+=e;return n},V=function(e,t){var n="",a=e.childNodes;t++,n+=F("	",t-1)+e.outerHTML.substring(0,e.outerHTML.indexOf("<li"));for(var r=0;r<a.length;r++)a[r].outerHTML&&(n+="ul"===a[r].nodeName.toLowerCase()||"ol"===a[r].nodeName.toLowerCase()?"\n"+V(a[r],t):"\n"+F("	",t)+a[r].outerHTML);return n+="\n"+F("	",t-1)+e.outerHTML.substring(e.outerHTML.lastIndexOf("<"))};w.$formatters.unshift(function(e){var t=angular.element("<div>"+e+"</div>")[0].childNodes;if(t.length>0){e="";for(var n=0;n<t.length;n++)t[n].outerHTML&&(e.length>0&&(e+="\n"),e+="ul"===t[n].nodeName.toLowerCase()||"ol"===t[n].nodeName.toLowerCase()?""+V(t[n],0):""+t[n].outerHTML)}return e})}var U=function(t){return w.$oldViewValue=e(l(t),w.$oldViewValue,A)},j=function(e){return x.required&&w.$setValidity("required",!_(e)),e};w.$parsers.push(U),w.$parsers.unshift(j),w.$formatters.push(U),w.$formatters.unshift(function(e){if(_(e))return e;var t=angular.element("<div>"+e+"</div>");return 0===t.children().length&&(e="<"+x.taDefaultWrap+">"+e+"</"+x.taDefaultWrap+">"),e}),w.$formatters.unshift(j),w.$formatters.unshift(function(e){return w.$undoManager.push(e||"")});var K=function(e){return c.$emit("ta-element-select",this),e.preventDefault(),!1},G=function(e,n){if(n&&angular.extend(e,n),!h&&!R){h=!0;var a;a=e.originalEvent?e.originalEvent.dataTransfer:e.dataTransfer,c.$emit("ta-drop-event",this,e,a),t(function(){h=!1,P()},100)}},Y=c["reApplyOnSelectorHandlers"+(x.id||"")]=function(){R||angular.forEach(f,function(e){b.find(e).off("click",K).on("click",K)})},Q=function(e){b[0].innerHTML=e};w.$render=function(){var e=w.$viewValue||"";D||(N&&k&&(b.removeClass("placeholder-text"),b[0].blur(),t(function(){b[0].focus(),u.setSelectionToElementEnd(b.children()[b.children().length-1])},1)),N?(Q(x.placeholder?""===e?S:e:""===e?S:e),R?b.off("drop",G):(Y(),b.on("drop",G))):"textarea"!==b[0].tagName.toLowerCase()&&"input"!==b[0].tagName.toLowerCase()?Q(p(e)):b.val(e)),N&&x.placeholder&&(""===e?k?b.removeClass("placeholder-text"):b.addClass("placeholder-text"):b.removeClass("placeholder-text")),D=!1},x.taReadonly&&(R=c.$eval(x.taReadonly),R?(b.addClass("ta-readonly"),("textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase())&&b.attr("disabled","disabled"),void 0!==b.attr("contenteditable")&&b.attr("contenteditable")&&b.removeAttr("contenteditable")):(b.removeClass("ta-readonly"),"textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase()?b.removeAttr("disabled"):N&&b.attr("contenteditable","true")),c.$watch(x.taReadonly,function(e,t){t!==e&&(e?(b.addClass("ta-readonly"),("textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase())&&b.attr("disabled","disabled"),void 0!==b.attr("contenteditable")&&b.attr("contenteditable")&&b.removeAttr("contenteditable"),angular.forEach(f,function(e){b.find(e).on("click",K)}),b.off("drop",G)):(b.removeClass("ta-readonly"),"textarea"===b[0].tagName.toLowerCase()||"input"===b[0].tagName.toLowerCase()?b.removeAttr("disabled"):N&&b.attr("contenteditable","true"),angular.forEach(f,function(e){b.find(e).off("click",K)}),b.on("drop",G)),R=e)})),N&&!R&&(angular.forEach(f,function(e){b.find(e).on("click",K)}),b.on("drop",G),b.on("blur",function(){n.webkit&&(a=!0)}))}}}]);var h=!1,g=angular.module("textAngular",["ngSanitize","textAngularSetup","textAngular.factories","textAngular.DOM","textAngular.validators","textAngular.taBind"]),m={};g.constant("taRegisterTool",t),g.value("taTools",m),g.config([function(){angular.forEach(m,function(e,t){delete m[t]})}]),g.run([function(){if(!window.rangy)throw"rangy-core.js and rangy-selectionsaverestore.js are required for textAngular to work correctly, rangy-core is not yet loaded.";if(window.rangy.init(),!window.rangy.saveSelection)throw"rangy-selectionsaverestore.js is required for textAngular to work correctly."}]),g.directive("textAngular",["$compile","$timeout","taOptions","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log","$q","$parse",function(e,t,n,a,r,o,i,l,s,d,c,u){return{require:"?ngModel",scope:{},restrict:"EA",link:function(f,p,h,g){var m,v,y,b,x,w,E,C,S,T,N=h.serial?h.serial:Math.floor(1e16*Math.random());f._name=h.name?h.name:"textAngularEditor"+N;var $=function(e,n,a){t(function(){var t=function(){e.off(n,t),a.apply(this,arguments)};e.on(n,t)},100)};S=r(h.taDefaultWrap),angular.extend(f,angular.copy(n),{wrapSelection:function(e,t,n){"undo"===e.toLowerCase()?f["$undoTaBindtaTextElement"+N]():"redo"===e.toLowerCase()?f["$redoTaBindtaTextElement"+N]():(S(e,!1,t),n&&f["reApplyOnSelectorHandlerstaTextElement"+N](),f.displayElements.text[0].focus())},showHtml:f.$eval(h.taShowHtml)||!1}),h.taFocussedClass&&(f.classes.focussed=h.taFocussedClass),h.taTextEditorClass&&(f.classes.textEditor=h.taTextEditorClass),h.taHtmlEditorClass&&(f.classes.htmlEditor=h.taHtmlEditorClass),h.taTextEditorSetup&&(f.setup.textEditorSetup=f.$parent.$eval(h.taTextEditorSetup)),h.taHtmlEditorSetup&&(f.setup.htmlEditorSetup=f.$parent.$eval(h.taHtmlEditorSetup)),f.fileDropHandler=h.taFileDrop?f.$parent.$eval(h.taFileDrop):f.defaultFileDropHandler,E=p[0].innerHTML,p[0].innerHTML="",f.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea name='descripcion2' required></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"></div>'),popoverArrow:angular.element('<div class="arrow"></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}},f.displayElements.popover.append(f.displayElements.popoverArrow),f.displayElements.popover.append(f.displayElements.popoverContainer),f.displayElements.scrollWindow.append(f.displayElements.popover),f.displayElements.popover.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),f.showPopover=function(e){f.displayElements.popover.css("display","block"),f.reflowPopover(e),s.addClass(f.displayElements.popover,"in"),$(l.find("body"),"click keyup",function(){f.hidePopover()})},f.reflowPopover=function(e){f.displayElements.text[0].offsetHeight-51>e[0].offsetTop?(f.displayElements.popover.css("top",e[0].offsetTop+e[0].offsetHeight+"px"),f.displayElements.popover.removeClass("top").addClass("bottom")):(f.displayElements.popover.css("top",e[0].offsetTop-54+"px"),f.displayElements.popover.removeClass("bottom").addClass("top"));var t=f.displayElements.text[0].offsetWidth-f.displayElements.popover[0].offsetWidth,n=e[0].offsetLeft+e[0].offsetWidth/2-f.displayElements.popover[0].offsetWidth/2;f.displayElements.popover.css("left",Math.max(0,Math.min(t,n))+"px"),f.displayElements.popoverArrow.css("margin-left",Math.min(n,Math.max(0,n-t))-11+"px")},f.hidePopover=function(){var e=function(){f.displayElements.popover.css("display",""),f.displayElements.popoverContainer.attr("style",""),f.displayElements.popoverContainer.attr("class","popover-content")};c.when(s.removeClass(f.displayElements.popover,"in",e)).then(e)},f.displayElements.resize.overlay.append(f.displayElements.resize.background),angular.forEach(f.displayElements.resize.anchors,function(e){f.displayElements.resize.overlay.append(e)}),f.displayElements.resize.overlay.append(f.displayElements.resize.info),f.displayElements.scrollWindow.append(f.displayElements.resize.overlay),f.reflowResizeOverlay=function(e){e=angular.element(e)[0],f.displayElements.resize.overlay.css({display:"block",left:e.offsetLeft-5+"px",top:e.offsetTop-5+"px",width:e.offsetWidth+10+"px",height:e.offsetHeight+10+"px"}),f.displayElements.resize.info.text(e.offsetWidth+" x "+e.offsetHeight)},f.showResizeOverlay=function(e){var t=l.find("body");T=function(n){var a={width:parseInt(e.attr("width")),height:parseInt(e.attr("height")),x:n.clientX,y:n.clientY};(void 0===a.width||isNaN(a.width))&&(a.width=e[0].offsetWidth),(void 0===a.height||isNaN(a.height))&&(a.height=e[0].offsetHeight),f.hidePopover();var r=a.height/a.width,o=function(t){var n={x:Math.max(0,a.width+(t.clientX-a.x)),y:Math.max(0,a.height+(t.clientY-a.y))};if(t.shiftKey){var o=n.y/n.x;n.x=r>o?n.x:n.y/r,n.y=r>o?n.x*r:n.y}el=angular.element(e),el.attr("height",Math.max(0,n.y)),el.attr("width",Math.max(0,n.x)),f.reflowResizeOverlay(e)};t.on("mousemove",o),$(t,"mouseup",function(n){n.preventDefault(),n.stopPropagation(),t.off("mousemove",o),f.showPopover(e)}),n.stopPropagation(),n.preventDefault()},f.displayElements.resize.anchors[3].on("mousedown",T),f.reflowResizeOverlay(e),$(t,"click",function(){f.hideResizeOverlay()})},f.hideResizeOverlay=function(){f.displayElements.resize.anchors[3].off("mousedown",T),f.displayElements.resize.overlay.css("display","")},f.setup.htmlEditorSetup(f.displayElements.html),f.setup.textEditorSetup(f.displayElements.text),f.displayElements.html.attr({id:"taHtmlElement"+N,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"}),f.displayElements.text.attr({id:"taTextElement"+N,contentEditable:"true","ta-bind":"ta-bind","ng-model":"html"}),f.displayElements.scrollWindow.attr({"ng-hide":"showHtml"}),h.taDefaultWrap&&f.displayElements.text.attr("ta-default-wrap",h.taDefaultWrap),h.taUnsafeSanitizer&&(f.displayElements.text.attr("ta-unsafe-sanitizer",h.taUnsafeSanitizer),f.displayElements.html.attr("ta-unsafe-sanitizer",h.taUnsafeSanitizer)),f.displayElements.scrollWindow.append(f.displayElements.text),p.append(f.displayElements.scrollWindow),p.append(f.displayElements.html),f.displayElements.forminput.attr("name",f._name),p.append(f.displayElements.forminput),h.tabindex&&(p.removeAttr("tabindex"),f.displayElements.text.attr("tabindex",h.tabindex),f.displayElements.html.attr("tabindex",h.tabindex)),h.placeholder&&(f.displayElements.text.attr("placeholder",h.placeholder),f.displayElements.html.attr("placeholder",h.placeholder)),h.taDisabled&&(f.displayElements.text.attr("ta-readonly","disabled"),f.displayElements.html.attr("ta-readonly","disabled"),f.disabled=f.$parent.$eval(h.taDisabled),f.$parent.$watch(h.taDisabled,function(e){f.disabled=e,f.disabled?p.addClass(f.classes.disabled):p.removeClass(f.classes.disabled)})),h.taPaste&&(f._pasteHandler=function(e){return u(h.taPaste)(f.$parent,{$html:e})},f.displayElements.text.attr("ta-paste","_pasteHandler($html)")),e(f.displayElements.scrollWindow)(f),e(f.displayElements.html)(f),f.updateTaBindtaTextElement=f["updateTaBindtaTextElement"+N],f.updateTaBindtaHtmlElement=f["updateTaBindtaHtmlElement"+N],p.addClass("ta-root"),f.displayElements.scrollWindow.addClass("ta-text ta-editor "+f.classes.textEditor),f.displayElements.html.addClass("ta-html ta-editor "+f.classes.htmlEditor),f._actionRunning=!1;var R=!1;if(f.startAction=function(){return f._actionRunning=!0,R=i.rangy.saveSelection(),function(){R&&i.rangy.restoreSelection(R)}},f.endAction=function(){f._actionRunning=!1,R&&i.rangy.removeMarkers(R),R=!1,f.updateSelectedStyles(),f.showHtml||f["updateTaBindtaTextElement"+N]()},x=function(){f.focussed=!0,p.addClass(f.classes.focussed),C.focus(),p.triggerHandler("focus")},f.displayElements.html.on("focus",x),f.displayElements.text.on("focus",x),w=function(e){return f._actionRunning||l[0].activeElement===f.displayElements.html[0]||l[0].activeElement===f.displayElements.text[0]||(p.removeClass(f.classes.focussed),C.unfocus(),t(function(){f._bUpdateSelectedStyles=!1,p.triggerHandler("blur"),f.focussed=!1},0)),e.preventDefault(),!1},f.displayElements.html.on("blur",w),f.displayElements.text.on("blur",w),f.displayElements.text.on("paste",function(e){p.triggerHandler("paste",e)}),f.queryFormatBlockState=function(e){return!f.showHtml&&e.toLowerCase()===l[0].queryCommandValue("formatBlock").toLowerCase()},f.queryCommandState=function(e){return f.showHtml?"":l[0].queryCommandState(e)},f.switchView=function(){f.showHtml=!f.showHtml,s.enabled(!1,f.displayElements.html),s.enabled(!1,f.displayElements.text),f.showHtml?t(function(){return s.enabled(!0,f.displayElements.html),s.enabled(!0,f.displayElements.text),f.displayElements.html[0].focus()},100):t(function(){return s.enabled(!0,f.displayElements.html),s.enabled(!0,f.displayElements.text),f.displayElements.text[0].focus()},100)},h.ngModel){var k=!0;g.$render=function(){if(k){k=!1;var e=f.$parent.$eval(h.ngModel);void 0!==e&&null!==e||!E||""===E||g.$setViewValue(E)}f.displayElements.forminput.val(g.$viewValue),f._elementSelectTriggered||(f.html=g.$viewValue||"")};var D=function(e){return h.required&&g.$setValidity("required",!(!e||""===e.trim())),e};g.$parsers.push(D),g.$formatters.push(D)}else f.displayElements.forminput.val(E),f.html=E;if(f.$watch("html",function(e,t){e!==t&&(h.ngModel&&g.$viewValue!==e&&g.$setViewValue(e),f.displayElements.forminput.val(e))}),h.taTargetToolbars)C=o.registerEditor(f._name,f,h.taTargetToolbars.split(","));else{var A=angular.element('<div text-angular-toolbar name="textAngularToolbar'+N+'">');h.taToolbar&&A.attr("ta-toolbar",h.taToolbar),h.taToolbarClass&&A.attr("ta-toolbar-class",h.taToolbarClass),h.taToolbarGroupClass&&A.attr("ta-toolbar-group-class",h.taToolbarGroupClass),h.taToolbarButtonClass&&A.attr("ta-toolbar-button-class",h.taToolbarButtonClass),h.taToolbarActiveButtonClass&&A.attr("ta-toolbar-active-button-class",h.taToolbarActiveButtonClass),h.taFocussedClass&&A.attr("ta-focussed-class",h.taFocussedClass),p.prepend(A),e(A)(f.$parent),C=o.registerEditor(f._name,f,["textAngularToolbar"+N])}f.$on("$destroy",function(){o.unregisterEditor(f._name)}),f.$on("ta-element-select",function(e,t){C.triggerElementSelect(e,t)&&f["reApplyOnSelectorHandlerstaTextElement"+N]()}),f.$on("ta-drop-event",function(e,n,a,r){f.displayElements.text[0].focus(),r&&r.files&&r.files.length>0?(angular.forEach(r.files,function(e){try{c.when(f.fileDropHandler(e,f.wrapSelection)||f.fileDropHandler!==f.defaultFileDropHandler&&c.when(f.defaultFileDropHandler(e,f.wrapSelection))).then(function(){f["updateTaBindtaTextElement"+N]()})}catch(t){d.error(t)}}),a.preventDefault(),a.stopPropagation()):t(function(){f["updateTaBindtaTextElement"+N]()},0)}),f._bUpdateSelectedStyles=!1,angular.element(window).on("blur",function(){f._bUpdateSelectedStyles=!1,f.focussed=!1}),f.updateSelectedStyles=function(){var e;void 0!==(e=a.getSelectionElement())&&e.parentNode!==f.displayElements.text[0]?C.updateSelectedStyles(angular.element(e)):C.updateSelectedStyles(),f._bUpdateSelectedStyles&&t(f.updateSelectedStyles,200)},m=function(){return f.focussed?void(f._bUpdateSelectedStyles||(f._bUpdateSelectedStyles=!0,f.$apply(function(){f.updateSelectedStyles()}))):void(f._bUpdateSelectedStyles=!1)},f.displayElements.html.on("keydown",m),f.displayElements.text.on("keydown",m),v=function(){f._bUpdateSelectedStyles=!1},f.displayElements.html.on("keyup",v),f.displayElements.text.on("keyup",v),y=function(e,t){t&&angular.extend(e,t),f.$apply(function(){return C.sendKeyCommand(e)?(f._bUpdateSelectedStyles||f.updateSelectedStyles(),e.preventDefault(),!1):void 0})},f.displayElements.html.on("keypress",y),f.displayElements.text.on("keypress",y),b=function(){f._bUpdateSelectedStyles=!1,f.$apply(function(){f.updateSelectedStyles()})},f.displayElements.html.on("mouseup",b),f.displayElements.text.on("mouseup",b)}}}]),g.service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(e,t,n){var a={},r={};return{registerEditor:function(n,o,i){if(!n||""===n)throw"textAngular Error: An editor requires a name";if(!o)throw"textAngular Error: An editor requires a scope";if(r[n])throw'textAngular Error: An Editor with name "'+n+'" already exists';var l=[];return angular.forEach(i,function(e){a[e]&&l.push(a[e])}),r[n]={scope:o,toolbars:i,_registerToolbar:function(e){this.toolbars.indexOf(e.name)>=0&&l.push(e)},editorFunctions:{disable:function(){angular.forEach(l,function(e){e.disabled=!0})},enable:function(){angular.forEach(l,function(e){e.disabled=!1})},focus:function(){angular.forEach(l,function(e){e._parent=o,e.disabled=!1,e.focussed=!0,o.focussed=!0})},unfocus:function(){angular.forEach(l,function(e){e.disabled=!0,e.focussed=!1}),o.focussed=!1},updateSelectedStyles:function(e){angular.forEach(l,function(t){angular.forEach(t.tools,function(n){n.activeState&&(t._parent=o,n.active=n.activeState(e))})})},sendKeyCommand:function(n){var a=!1;return(n.ctrlKey||n.metaKey)&&angular.forEach(t,function(t,r){if(t.commandKeyCode&&t.commandKeyCode===n.which)for(var i=0;i<l.length;i++)if(void 0!==l[i].tools[r]){e.call(l[i].tools[r],o),a=!0;break}}),a},triggerElementSelect:function(e,n){var a=function(e,t){for(var n=!0,a=0;a<t.length;a++)n=n&&e.attr(t[a]);return n},r=[],i={},s=!1;n=angular.element(n);var d=!1;if(angular.forEach(t,function(e,t){e.onElementSelect&&e.onElementSelect.element&&e.onElementSelect.element.toLowerCase()===n[0].tagName.toLowerCase()&&(!e.onElementSelect.filter||e.onElementSelect.filter(n))&&(d=d||angular.isArray(e.onElementSelect.onlyWithAttrs)&&a(n,e.onElementSelect.onlyWithAttrs),(!e.onElementSelect.onlyWithAttrs||a(n,e.onElementSelect.onlyWithAttrs))&&(i[t]=e))}),d?(angular.forEach(i,function(e,t){e.onElementSelect.onlyWithAttrs&&a(n,e.onElementSelect.onlyWithAttrs)&&r.push({name:t,tool:e})}),r.sort(function(e,t){return t.tool.onElementSelect.onlyWithAttrs.length-e.tool.onElementSelect.onlyWithAttrs.length})):angular.forEach(i,function(e,t){r.push({name:t,tool:e})}),r.length>0)for(var c=0;c<r.length;c++){for(var u=r[c].tool,f=r[c].name,p=0;p<l.length;p++)if(void 0!==l[p].tools[f]){u.onElementSelect.action.call(l[p].tools[f],e,n,o),s=!0;break}if(s)break}return s}}},r[n].editorFunctions},retrieveEditor:function(e){return r[e]},unregisterEditor:function(e){delete r[e]},registerToolbar:function(e){if(!e)throw"textAngular Error: A toolbar requires a scope";if(!e.name||""===e.name)throw"textAngular Error: A toolbar requires a name";if(a[e.name])throw'textAngular Error: A toolbar with name "'+e.name+'" already exists';a[e.name]=e,angular.forEach(r,function(t){t._registerToolbar(e)})},retrieveToolbar:function(e){return a[e]},retrieveToolbarsViaEditor:function(e){var t=[],n=this;return angular.forEach(this.retrieveEditor(e).toolbars,function(e){t.push(n.retrieveToolbar(e))}),t},unregisterToolbar:function(e){delete a[e]},updateToolsDisplay:function(e){var t=this;angular.forEach(e,function(e,n){t.updateToolDisplay(n,e)})},resetToolsDisplay:function(){var e=this;angular.forEach(t,function(t,n){e.resetToolDisplay(n)})},updateToolDisplay:function(e,t){var n=this;angular.forEach(a,function(a,r){n.updateToolbarToolDisplay(r,e,t)})},resetToolDisplay:function(e){var t=this;angular.forEach(a,function(n,a){t.resetToolbarToolDisplay(a,e)})},updateToolbarToolDisplay:function(e,t,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(t,n)},resetToolbarToolDisplay:function(e,n){if(!a[e])throw'textAngular Error: No Toolbar with name "'+e+'" exists';a[e].updateToolDisplay(n,t[n],!0)},removeTool:function(e){delete t[e],angular.forEach(a,function(t){delete t.tools[e];for(var n=0;n<t.toolbar.length;n++){for(var a,r=0;r<t.toolbar[n].length;r++){if(t.toolbar[n][r]===e){a={group:n,index:r};break}if(void 0!==a)break}void 0!==a&&(t.toolbar[a.group].slice(a.index,1),t._$element.children().eq(a.group).children().eq(a.index).remove())}})},addTool:function(e,t,r,o){n(e,t),angular.forEach(a,function(n){n.addTool(e,t,r,o)})},addToolToToolbar:function(e,t,r,o,i){n(e,t),a[r].addTool(e,t,o,i)},refreshEditor:function(e){if(!r[e])throw'textAngular Error: No Editor with name "'+e+'" exists';r[e].scope.updateTaBindtaTextElement(),r[e].scope.$$phase||r[e].scope.$digest()}}}]),g.directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function(e,t,n,a,r,o){return{scope:{name:"@"},restrict:"EA",link:function(i,l,s){if(!i.name||""===i.name)throw"textAngular Error: A toolbar requires a name";angular.extend(i,angular.copy(n)),s.taToolbar&&(i.toolbar=i.$parent.$eval(s.taToolbar)),s.taToolbarClass&&(i.classes.toolbar=s.taToolbarClass),s.taToolbarGroupClass&&(i.classes.toolbarGroup=s.taToolbarGroupClass),s.taToolbarButtonClass&&(i.classes.toolbarButton=s.taToolbarButtonClass),s.taToolbarActiveButtonClass&&(i.classes.toolbarButtonActive=s.taToolbarActiveButtonClass),s.taFocussedClass&&(i.classes.focussed=s.taFocussedClass),i.disabled=!0,i.focussed=!1,i._$element=l,l[0].innerHTML="",l.addClass("ta-toolbar "+i.classes.toolbar),i.$watch("focussed",function(){i.focussed?l.addClass(i.classes.focussed):l.removeClass(i.classes.focussed)});var d=function(t,n){var a;if(a=angular.element(t&&t.display?t.display:"<button type='button'>"),a.addClass(t&&t["class"]?t["class"]:i.classes.toolbarButton),a.attr("name",n.name),a.attr("unselectable","on"),a.attr("ng-disabled","isDisabled()"),a.attr("tabindex","-1"),a.attr("ng-click","executeAction()"),a.attr("ng-class","displayActiveToolClass(active)"),t&&t.tooltiptext&&a.attr("title",t.tooltiptext),a.on("mousedown",function(e,t){return t&&angular.extend(e,t),e.preventDefault(),!1}),t&&!t.display&&!n._display&&(a[0].innerHTML="",t.buttontext&&(a[0].innerHTML=t.buttontext),t.iconclass)){var r=angular.element("<i>"),o=a[0].innerHTML;r.addClass(t.iconclass),a[0].innerHTML="",a.append(r),o&&""!==o&&a.append("&nbsp;"+o)}return n._lastToolDefinition=angular.copy(t),e(a)(n)};i.tools={},i._parent={disabled:!0,showHtml:!1,queryFormatBlockState:function(){return!1},queryCommandState:function(){return!1}};var c={$window:o,$editor:function(){return i._parent},isDisabled:function(){return"function"!=typeof this.$eval("disabled")&&this.$eval("disabled")||this.$eval("disabled()")||"html"!==this.name&&this.$editor().showHtml||this.$parent.disabled||this.$editor().disabled},displayActiveToolClass:function(e){return e?i.classes.toolbarButtonActive:""},executeAction:r};angular.forEach(i.toolbar,function(e){var t=angular.element("<div>");t.addClass(i.classes.toolbarGroup),angular.forEach(e,function(e){i.tools[e]=angular.extend(i.$new(!0),a[e],c,{name:e}),i.tools[e].$element=d(a[e],i.tools[e]),t.append(i.tools[e].$element)}),l.append(t)}),i.updateToolDisplay=function(e,t,n){var a=i.tools[e];if(a){if(a._lastToolDefinition&&!n&&(t=angular.extend({},a._lastToolDefinition,t)),null===t.buttontext&&null===t.iconclass&&null===t.display)throw'textAngular Error: Tool Definition for updating "'+e+'" does not have a valid display/iconclass/buttontext value';null===t.buttontext&&delete t.buttontext,null===t.iconclass&&delete t.iconclass,null===t.display&&delete t.display;var r=d(t,a);a.$element.replaceWith(r),a.$element=r}},i.addTool=function(e,t,n,r){i.tools[e]=angular.extend(i.$new(!0),a[e],c,{name:e}),i.tools[e].$element=d(a[e],i.tools[e]);var o;void 0===n&&(n=i.toolbar.length-1),o=angular.element(l.children()[n]),void 0===r?(o.append(i.tools[e].$element),i.toolbar[n][i.toolbar[n].length-1]=e):(o.children().eq(r).after(i.tools[e].$element),i.toolbar[n][r]=e)},t.registerToolbar(i),i.$on("$destroy",function(){t.unregisterToolbar(i.name)})}}}])}()}({},function(){return this}());